(function(e){function t(t){for(var n,o,s=t[0],c=t[1],_=t[2],l=0,d=[];l<s.length;l++)o=s[l],Object.prototype.hasOwnProperty.call(a,o)&&a[o]&&d.push(a[o][0]),a[o]=0;for(n in c)Object.prototype.hasOwnProperty.call(c,n)&&(e[n]=c[n]);u&&u(t);while(d.length)d.shift()();return i.push.apply(i,_||[]),r()}function r(){for(var e,t=0;t<i.length;t++){for(var r=i[t],n=!0,o=1;o<r.length;o++){var c=r[o];0!==a[c]&&(n=!1)}n&&(i.splice(t--,1),e=s(s.s=r[0]))}return e}var n={},a={app:0},i=[];function o(e){return s.p+"js/"+({about:"about"}[e]||e)+"."+{about:"4a476070"}[e]+".js"}function s(t){if(n[t])return n[t].exports;var r=n[t]={i:t,l:!1,exports:{}};return e[t].call(r.exports,r,r.exports,s),r.l=!0,r.exports}s.e=function(e){var t=[],r=a[e];if(0!==r)if(r)t.push(r[2]);else{var n=new Promise((function(t,n){r=a[e]=[t,n]}));t.push(r[2]=n);var i,c=document.createElement("script");c.charset="utf-8",c.timeout=120,s.nc&&c.setAttribute("nonce",s.nc),c.src=o(e);var _=new Error;i=function(t){c.onerror=c.onload=null,clearTimeout(l);var r=a[e];if(0!==r){if(r){var n=t&&("load"===t.type?"missing":t.type),i=t&&t.target&&t.target.src;_.message="Loading chunk "+e+" failed.\n("+n+": "+i+")",_.name="ChunkLoadError",_.type=n,_.request=i,r[1](_)}a[e]=void 0}};var l=setTimeout((function(){i({type:"timeout",target:c})}),12e4);c.onerror=c.onload=i,document.head.appendChild(c)}return Promise.all(t)},s.m=e,s.c=n,s.d=function(e,t,r){s.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},s.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},s.t=function(e,t){if(1&t&&(e=s(e)),8&t)return e;if(4&t&&"object"===typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(s.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var n in e)s.d(r,n,function(t){return e[t]}.bind(null,n));return r},s.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return s.d(t,"a",t),t},s.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},s.p="/",s.oe=function(e){throw console.error(e),e};var c=window["webpackJsonp"]=window["webpackJsonp"]||[],_=c.push.bind(c);c.push=t,c=c.slice();for(var l=0;l<c.length;l++)t(c[l]);var u=_;i.push([0,"chunk-vendors"]),r()})({0:function(e,t,r){e.exports=r("56d7")},"000c":function(e,t,r){},"02f9":function(e,t,r){"use strict";r("000c")},"179d":function(e,t,r){"use strict";r("38b0")},"23a7":function(e,t,r){},"2d07":function(e,t,r){"use strict";r("3f9c")},"38b0":function(e,t,r){},"3f9c":function(e,t,r){},5353:function(e,t,r){"use strict";r("f02d")},"56d7":function(e,t,r){"use strict";r.r(t);var n={};r.r(n),r.d(n,"VectorLayer",(function(){return J})),r.d(n,"ImageLayer",(function(){return se})),r.d(n,"ItkVtkLayer",(function(){return Ee})),r.d(n,"RemoteLayer",(function(){return Le}));var a={};r.r(a),r.d(a,"ControlWidget",(function(){return We})),r.d(a,"FormWidget",(function(){return _t})),r.d(a,"ListWidget",(function(){return mt})),r.d(a,"VegaWidget",(function(){return Mt})),r.d(a,"TreeWidget",(function(){return Wt}));r("4160"),r("b64b"),r("159b");var i=r("5530"),o=(r("e260"),r("e6cf"),r("cca6"),r("a79d"),r("2b0e")),s=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{attrs:{id:"app"}},[r("router-view")],1)},c=[],_=r("2877"),l={},u=Object(_["a"])(l,s,c,!1,null,null,null),d=u.exports,f=r("9483");Object(f["a"])("".concat("/","service-worker.js"),{ready:function(){console.log("App is being served from cache by a service worker.\nFor more details, visit https://goo.gl/AFskqB")},registered:function(){console.log("Service worker has been registered.")},cached:function(){console.log("Content has been cached for offline use.")},updatefound:function(){console.log("New content is downloading.")},updated:function(){console.log("New content is available; please refresh.")},offline:function(){console.log("No internet connection found. App is running in offline mode.")},error:function(e){console.error("Error during service worker registration:",e)}});r("d3b7");var p=r("8c4f"),m=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{staticClass:"sidebar-page"},[r("section",{staticClass:"sidebar-layout"},[r("div",{directives:[{name:"show",rawName:"v-show",value:e.loading,expression:"loading"}],staticClass:"lds-ellipsis"},[r("div"),r("div"),r("div"),r("div")]),r("b-sidebar",{attrs:{position:e.position,fullheight:!0,fullwidth:!1,overlay:!1,open:e.open,mobile:e.mobile,"can-cancel":!0,"expand-on-hover":e.expandOnHover,reduce:e.reduce,type:"is-light"},on:{"update:open":function(t){e.open=t}}},[r("div",{staticClass:"p-1"},[r("div",{staticClass:"block"},[r("img",{style:{width:"full"===e.mode?"220px":"120px"},attrs:{src:"static/img/kaibu-banner.svg"}}),r("button",{staticClass:"button floating-close-btn is-small",on:{click:function(t){return e.openSidebar(!1)}}},[r("b-icon",{attrs:{icon:"chevron-left"}})],1)]),"full"===e.mode?r("div",{staticClass:"block"},[r("div",{staticClass:"field"},[r("b-dropdown",{attrs:{"aria-role":"list"},scopedSlots:e._u([{key:"trigger",fn:function(t){var n=t.active;return r("b-button",{staticClass:"is-primary",attrs:{"icon-left":"plus"}},[r("span",[e._v("Add layer")]),r("b-icon",{attrs:{icon:n?"menu-up":"menu-down"}})],1)}}],null,!1,1023202259)},[r("input",{ref:"file_input",staticStyle:{display:"none"},attrs:{type:"file",multiple:""},on:{change:function(t){return e.loadFiles(t)}}}),r("b-dropdown-item",{attrs:{value:"file","aria-role":"listitem"},on:{click:function(t){return e.$refs.file_input.click()}}},[r("b-icon",{attrs:{icon:"file-import"}}),e._v(" From File(s)")],1),e._l(e.layerTypes,(function(t,n){return r("b-dropdown-item",{directives:[{name:"show",rawName:"v-show",value:t.show,expression:"comp.show"}],key:n,attrs:{value:n,"aria-role":"listitem"},on:{click:function(t){return e.newLayer(n)}}},[r("b-icon",{attrs:{icon:"layers"}}),e._v(e._s(n))],1)}))],2),e._v(" "),r("b-button",{attrs:{target:"_blank","icon-left":"book-open-outline"},on:{click:function(t){return e.goto("/docs")}}},[e._v(" Docs ")]),r("b-dropdown",{attrs:{"aria-role":"list",position:"is-bottom-left"}},[r("button",{staticClass:"button",attrs:{slot:"trigger"},slot:"trigger"},[r("b-icon",{attrs:{slot:"trigger",icon:"dots-vertical"},slot:"trigger"})],1),r("b-dropdown-item",{attrs:{"aria-role":"listitem"},on:{click:function(t){return e.goto("https://github.com/imjoy-team/kaibu")}}},[r("b-icon",{attrs:{icon:"github"}}),e._v(" Github")],1),r("b-dropdown-item",{attrs:{"aria-role":"listitem"},on:{click:function(t){return e.screenshot()}}},[r("b-icon",{attrs:{icon:"camera"}}),e._v(" Screenshot")],1),r("b-dropdown-item",{attrs:{"aria-role":"listitem"},on:{click:function(t){return e.goto("/#/about")}}},[r("b-icon",{attrs:{icon:"information-variant"}}),e._v(" About Kaibu v"+e._s(e.version))],1)],1)],1)]):e._e(),Object.keys(e.standaloneWidgets).length>0?r("b-tabs",{staticClass:"block",attrs:{size:"is-small"}},e._l(e.standaloneWidgets,(function(t,n){return r("b-tab-item",{key:n,style:{"max-height":t.max_height?t.max_height+"px":"400px"},attrs:{label:t.name,icon:t.icon}},[r(e.widgetTypes[t.type],{tag:"component",attrs:{config:t},on:{loading:function(t){e.loading=t}}})],1)})),1):r("br"),r("b-menu",{directives:[{name:"sortable",rawName:"v-sortable",value:e.sortableOptions,expression:"sortableOptions"}],staticClass:"is-custom-mobile",on:{sorted:function(t){return e.layerSorted()}}},[r("b-menu-list",{attrs:{label:"Layers"}},e._l(e.layer_configs.slice().reverse(),(function(t){return r("b-menu-item",{key:t.id,staticClass:"layer-item",on:{click:function(r){return e.selectLayer(t)}}},[r("template",{slot:"label"},[r("button",{staticClass:"button is-small",on:{click:function(r){return e.toggleVisible(t)}}},[t.visible?r("b-icon",{attrs:{icon:"eye-outline"}}):r("b-icon",{attrs:{icon:"eye-off-outline"}})],1),e._v(" "+e._s(t.name&&t.name.slice(0,30)+(t.name.length>30?"...":"")||"Unnamed Layer")+" "),r("b-dropdown",{staticClass:"is-pulled-right",attrs:{"aria-role":"list",position:"is-bottom-left"}},[r("b-icon",{attrs:{slot:"trigger",icon:"dots-vertical"},slot:"trigger"}),r("b-dropdown-item",{attrs:{"aria-role":"listitem",icon:"close-circle"},on:{click:function(r){return e.removeLayer(t)}}},[e._v("Remove")])],1)],1)],2)})),1)],1),r("hr",{staticClass:"solid"}),r("div",{directives:[{name:"show",rawName:"v-show",value:e.currentLayer,expression:"currentLayer"}],staticClass:"block",staticStyle:{"min-height":"150px"}},[e.currentLayerWidget?r("b-menu-list",{attrs:{label:e.currentLayerWidget.name,icon:e.currentLayerWidget.icon}},[r(e.widgetTypes[e.currentLayerWidget.type],{tag:"component",attrs:{config:e.currentLayerWidget},on:{loading:function(t){e.loading=t}}})],1):e._e(),r("b-menu-list",{attrs:{label:"Properties"}},e._l(e.layer_configs,(function(t){return r(e.layerTypes[t.type],{directives:[{name:"show",rawName:"v-show",value:e.currentLayer===t,expression:"currentLayer === layer"}],key:t.id,ref:"layer_"+t.id,refInFor:!0,tag:"component",attrs:{selected:t.selected,visible:t.visible,map:e.map,config:t},on:{"update-extent":e.updateExtent,loading:function(t){e.loading=t}}})})),1)],1)],1)]),r("button",{directives:[{name:"show",rawName:"v-show",value:!e.open,expression:"!open"}],staticClass:"button floating-menu-btn",on:{click:function(t){return e.openSidebar(!0)}}},[r("img",{staticStyle:{width:"30px","border-radius":"6px"},attrs:{src:"static/img/kaibu-icon.svg"}})]),r("div",{staticClass:"p-1"},[r("div",{style:{width:e.viewerWidth},attrs:{id:"map"}}),e.activeSliders?r("section",{staticClass:"slider-container",style:{width:e.sliderWidth}},e._l(e.activeSliders,(function(t){return r("b-field",{key:t.name,staticStyle:{"margin-bottom":"0px!important"}},[r("label",{staticClass:"label slider-label"},[e._v(e._s(t.name))]),r("b-slider",{staticClass:"slider-body",attrs:{min:t.min||0,max:t.max||1,step:t.step||1},on:{change:t.change_callback},model:{value:t.value,callback:function(r){e.$set(t,"value",r)},expression:"slider.value"}})],1)})),1):e._e()])],1)])},g=[],h=(r("4de4"),r("d81d"),r("b0c0"),r("a9e3"),r("ac1f"),r("8a79"),r("3ca3"),r("466d"),r("1276"),r("ddb0"),r("2b3d"),r("96cf"),r("1da1")),y=r("b85c"),b=r("9224"),v=(r("5bc0"),r("a2c7")),w=r("5eee"),E=r("3a39");r("25f0");function k(){return Math.random().toString(36).substr(2,10)}var O=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{staticClass:"vector-layer"},[r("section",[r("div",{staticClass:"block"},[r("b-tooltip",{attrs:{label:"Cursor",position:"is-top"}},[r("button",{staticClass:"button is-medium",class:{"is-primary":!e.config.draw_enable&&!e.selectIsActive},on:{click:function(t){e.disableSelectInteraction(),e.config.draw_enable=!1,e.updateDrawInteraction(),e.$forceUpdate()}}},[r("b-icon",{attrs:{icon:"cursor-default-outline",size:"is-medium"}})],1)]),r("b-tooltip",{attrs:{label:"Select",position:"is-top"}},[r("button",{staticClass:"button is-medium",class:{"is-primary":!e.config.draw_enable&&e.selectIsActive},on:{click:function(t){e.enableSelectInteraction(),e.config.draw_enable=!1,e.updateDrawInteraction(),e.$forceUpdate()}}},[r("b-icon",{attrs:{icon:"cursor-default",size:"is-medium"}})],1)]),r("b-tooltip",{attrs:{label:"Draw Mode",position:"is-top"}},[r("button",{staticClass:"button is-medium",class:{"is-primary":e.config.draw_enable},on:{click:function(t){e.config.draw_enable=!0,e.updateDrawInteraction(),e.$forceUpdate()}}},[r("b-icon",{attrs:{icon:"lead-pencil",size:"is-medium"}})],1)]),e._v(" "),r("b-tooltip",{attrs:{label:"Freehand Mode",position:"is-top"}},[r("button",{staticClass:"button",class:{"is-primary":e.config.draw_freehand},attrs:{disabled:!e.config.draw_enable},on:{click:function(t){e.config.draw_freehand=!e.config.draw_freehand,e.updateDrawInteraction(),e.$forceUpdate()}}},[r("b-icon",{attrs:{icon:"gesture"}})],1)]),e._v(" "),r("b-tooltip",{attrs:{label:"Undo (Ctrl/Command+Z)",position:"is-top"}},[r("button",{staticClass:"button",on:{click:function(t){return e.undoDraw()}}},[r("b-icon",{attrs:{icon:"undo"}})],1)]),e._v(" "),r("b-tooltip",{attrs:{label:"Delete",position:"is-top"}},[r("button",{staticClass:"button",on:{click:function(t){return e.deleteDraw()}}},[r("b-icon",{attrs:{icon:"delete"}})],1)])],1),r("div",{staticClass:"block"},e._l(e.draw_types,(function(t,n){return r("b-tooltip",{key:n,attrs:{label:n,position:"is-bottom"}},[r("button",{staticClass:"button",class:{"is-primary":e.config.draw_shape_type===n},attrs:{disabled:!e.config.draw_enable},on:{click:function(t){return e.setDrawType(n)}}},[r("b-icon",{attrs:{icon:t,size:"is-medium"}})],1)])})),1),r("div",{staticClass:"block"},[r("label",{staticClass:"label",staticStyle:{display:"inline-block"}},[e._v("Color: ")]),r("b-tooltip",{attrs:{label:"Edge Color",position:"is-bottom"}},[r("v-swatches",{staticStyle:{top:"10px",margin:"1px"},attrs:{disabled:!e.config.draw_enable,swatches:["#0084ff","#44bec7","#ffc300","#fa3c4c","#d696bb","#ff48c4",{color:"#ffffff",showBorder:!0},"#000000"],"show-border":!0,"trigger-style":{width:"36px",height:"36px","border-radius":"5px"},"swatch-size":"32","show-fallback":"","fallback-input-type":"color","popover-x":"left"},model:{value:e.draw_edge_color,callback:function(t){e.draw_edge_color=t},expression:"draw_edge_color"}})],1),r("b-tooltip",{attrs:{label:"Face Color",position:"is-bottom"}},[r("v-swatches",{staticStyle:{top:"10px",margin:"1px"},attrs:{disabled:!e.config.draw_enable,swatches:["#0084ff60","#44bec760","#ffc30060","#fa3c4c60","#d696bb60","#f3ea5f60","#ff48c460","#00000000"],"show-border":!0,"trigger-style":{width:"36px",height:"36px","border-radius":"5px"},"swatch-size":"32","show-fallback":"","fallback-input-type":"color","popover-x":"left"},model:{value:e.draw_face_color,callback:function(t){e.draw_face_color=t},expression:"draw_face_color"}})],1)],1),r("b-field",[r("label",{staticClass:"label",staticStyle:{display:"inline-block"}},[e._v("Edge Width: ")]),r("b-numberinput",{attrs:{size:"is-small","controls-position":"compact"},on:{input:function(t){return e.setDrawType(e.config.draw_shape_type)}},model:{value:e.config.draw_edge_width,callback:function(t){e.$set(e.config,"draw_edge_width",t)},expression:"config.draw_edge_width"}})],1),"Point"===e.config.draw_shape_type?r("b-field",[r("label",{staticClass:"label",staticStyle:{display:"inline-block"}},[e._v("Point Size: ")]),r("b-numberinput",{attrs:{size:"is-small","controls-position":"compact"},model:{value:e.config.draw_size,callback:function(t){e.$set(e.config,"draw_size",t)},expression:"config.draw_size"}})],1):e._e(),r("b-field",[r("label",{staticClass:"label",staticStyle:{display:"inline-block"}},[e._v("Label: ")]),r("b-input",{attrs:{type:"text"},model:{value:e.config.draw_label,callback:function(t){e.$set(e.config,"draw_label",t)},expression:"config.draw_label"}})],1)],1),r("br"),e.currentFeature?r("section",[e.currentMetadata?r("b-field",{attrs:{label:"Tags"}},[r("b-taginput",{attrs:{data:e.config.predefined_tags,"open-on-focus":!!e.config.predefined_tags,ellipsis:"",type:"is-info",icon:"label",placeholder:"Add a tag","aria-close-label":"Delete this tag"},on:{add:function(t){e.normalizeTags(),e.updateMetadata()},remove:function(t){return e.updateMetadata()}},model:{value:e.currentMetadata.tags,callback:function(t){e.$set(e.currentMetadata,"tags",t)},expression:"currentMetadata.tags"}})],1):e._e(),null!==e.currentMetadata.rating&&void 0!=e.currentMetadata.rating?r("b-field",[r("b-rate",{attrs:{"custom-text":"Rating"},on:{change:function(t){return e.updateMetadata()}},model:{value:e.currentMetadata.rating,callback:function(t){e.$set(e.currentMetadata,"rating",t)},expression:"currentMetadata.rating"}})],1):e._e(),e._l(e.currentMetadata.comments,(function(t){return r("section",{key:t.id},[r("b-notification",{attrs:{"aria-close-label":"Close comment"},on:{close:function(r){return e.removeComment(t)}}},[e._v(" "+e._s(t.user_name?t.user_name+": ":"")+e._s(t.content)+" ")])],1)})),r("b-field",[r("b-input",{attrs:{maxlength:"1000",type:"textarea"},nativeOn:{keyup:function(t){if(!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter"))return null;e.addComment(),e.updateMetadata()}},model:{value:e.currentNewComment,callback:function(t){e.currentNewComment=t},expression:"currentNewComment"}})],1)],2):e._e(),r("br"),r("section",[r("input",{ref:"file_input",staticStyle:{display:"none"},attrs:{type:"file"},on:{change:function(t){return e.loadFeatures(t.target.files[0])}}}),e.vector_source?r("b-button",{attrs:{"icon-left":"file-import"},on:{click:function(t){return e.$refs.file_input.click()}}},[e._v(" Load ")]):e._e(),e.vector_source?r("b-button",{attrs:{"icon-left":"file-export"},on:{click:function(t){return e.exportFeatures()}}},[e._v(" Export ")]):e._e(),e.vector_source?r("b-button",{attrs:{"icon-left":"close"},on:{click:function(t){return e.clearFeatures()}}},[e._v(" Clear ")]):e._e()],1)])},j=[],P=(r("99af"),r("caad"),r("fb6a"),r("2532"),r("7f75")),D=r.n(P),C=(r("b3a4"),r("3e6b")),M=r("6c77"),x=r("83a6"),L=r("8682"),I=r("8295"),R=r("ce2c"),T=r("2ce2"),A=r("ac29"),U=r("5831"),W=r("a2e1"),B=r("5bc3"),F=r("0af5"),S=r("595b");function K(){for(var e="0123456789ABCDEF",t="#",r=0;r<6;r++)t+=e[Math.floor(16*Math.random())];return t}function $(){var e=String.fromCharCode(65+Math.floor(26*Math.random()));return e+Date.now()}function q(e,t){if(window.navigator.msSaveOrOpenBlob)window.navigator.msSaveOrOpenBlob(e,t);else{var r=document.createElement("a");document.body.appendChild(r);var n=window.URL.createObjectURL(e);r.href=n,r.download=t,r.click(),setTimeout((function(){window.URL.revokeObjectURL(n),document.body.removeChild(r)}),0)}}function z(e,t,r){var n,a,i,o,s,c,_,l,u,d,f=10,p=[],m=[],g=[],h=null;if(r=r||{},"Polygon"!=e.type&&"MultiPolygon"!=e.type||"LineString"!=t.type)return h;if(i=S["lineIntersect"](e,t),0==i.features.length)return h;var y=S["getCoords"](t);if(S["booleanWithin"](S["point"](y[0]),e)||S["booleanWithin"](S["point"](y[y.length-1]),e))return h;for(g[0]=S["lineOffset"](t,f),g[1]=S["lineOffset"](t,-f),n=0;n<=1;n++){o=n,s=(n+1)%2;var b=[];for(a=0;a<t.coordinates.length;a++)b.push(t.coordinates[a]);for(a=g[o].geometry.coordinates.length-1;a>=0;a--)b.push(g[o].geometry.coordinates[a]);for(b.push(t.coordinates[0]),c=S["lineString"](b),_=S["lineToPolygon"](c),l=S["difference"](e,_),p=[],a=0;a<l.geometry.coordinates.length;a++)u=S["polygon"](l.geometry.coordinates[a]),d=S["lineIntersect"](u,g[s]),d.features.length>0&&p.push(u.geometry.coordinates);p.forEach((function(e){m.push(S["polygon"](e,r))}))}return m.length>0&&(h=S["featureCollection"](m)),h}var V={name:"vector-layer",type:"vector",show:!0,components:{VSwatches:D.a},props:{map:{type:w["a"],default:null},selected:{type:Boolean,default:!1},visible:{type:Boolean,default:!1},config:{type:Object,default:function(){return{}}}},data:function(){return{layer:null,select:null,selectIsActive:!1,vector_source:null,draw_history:[],draw_edge_color:null,draw_face_color:null,draw_types:{Polygon:"vector-polygon",LineString:"vector-polyline",Rectangle:"vector-rectangle",Square:"vector-square",PolygonCutter:"box-cutter-off",Circle:"vector-circle-variant",Star:"octagram-outline",Point:"target"},currentFeature:null,currentMetadata:null,currentNewComment:null}},watch:{draw_edge_color:function(e){this.config.draw_edge_color=e,this.setupDrawInteraction()},draw_face_color:function(e){this.config.draw_face_color=e,this.setupDrawInteraction()},draw_edge_width:function(e){this.config.draw_edge_width=e,this.setupDrawInteraction()},selected:function(){this.updateDrawInteraction()},visible:function(e){this.layer.setVisible(e),this.updateDrawInteraction()}},mounted:function(){for(var e in this.default_config={data:null,shape_type:"polygon",edge_width:2,edge_color:K(),face_color:"rgba(255, 255, 255, 0.2)",z_index:null,name:"vector",metadata:null,scale:1,translate:0,opacity:1,blending:"additive",visible:!0,size:7,text_placement:null,draw_enable:!1,draw_freehand:!0,draw_label:null,draw_size:7,default_size:7,draw_shape_type:"Polygon",draw_face_color:"#FFFFFF0F",default_face_color:"#FFFFFF0F",draw_edge_width:2,default_edge_width:2,draw_edge_color:"#0BF737",default_edge_color:"#0BF737",draw_max_label_count:0},this.default_config)this.config[e]||(this.config[e]=this.default_config[e]);if(this.config.init=this.init,Array.isArray(this.config.data)){for(var t=0,r=["shape_type","edge_width","edge_color","face_color","size","z_index","label"];t<r.length;t++){var n=r[t];if(Array.isArray(this.config[n])&&this.config[n].length!==this.config.data.length)throw"Invalid length: ".concat(n," should have ").concat(this.config.data.length," elements.")}this.config.draw_edge_color=this.config.draw_edge_color||this.getConfig("edge_color",0),this.config.draw_edge_width=this.config.draw_edge_width||this.getConfig("edge_width",0),this.config.draw_face_color=this.config.draw_face_color||this.getConfig("face_color",0)}this.draw_edge_color=this.config.draw_edge_color,this.draw_face_color=this.config.draw_face_color,document.addEventListener("keydown",this.keyHandler)},beforeDestroy:function(){document.removeEventListener("keydown",this.keyHandler),this.layer&&(this.removeDrawInteraction(),this.map.removeLayer(this.layer))},created:function(){},methods:{init:function(){var e=this;return Object(h["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,e.setupLayer();case 2:return e.layer=t.sent,e.map.addLayer(e.layer),e.updateDrawInteraction(),e.$forceUpdate(),t.abrupt("return",e.layer);case 7:case"end":return t.stop()}}),t)})))()},setDrawType:function(e){this.config.draw_shape_type=e,this.$forceUpdate(),this.updateDrawInteraction()},keyHandler:function(e){this.selected&&this.visible&&("Backspace"===e.code||"Delete"===e.code?this.deleteDraw():"KeyZ"===e.code&&(e.metaKey||e.ctrlKey)?this.undoDraw():"ArrowRight"===e.code?e.metaKey||e.ctrlKey?this.moveSelected(1,0):e.shiftKey?this.moveSelected(30,0):this.moveSelected(10,0):"ArrowLeft"===e.code?e.metaKey||e.ctrlKey?this.moveSelected(-1,0):e.shiftKey?this.moveSelected(-30,0):this.moveSelected(-10,0):"ArrowUp"===e.code?e.metaKey||e.ctrlKey?this.moveSelected(0,1):e.shiftKey?this.moveSelected(0,30):this.moveSelected(0,10):"ArrowDown"===e.code&&(e.metaKey||e.ctrlKey?this.moveSelected(0,-1):e.shiftKey?this.moveSelected(0,-30):this.moveSelected(0,-10)))},moveSelected:function(e,t){var r=this.select.getFeatures();r.forEach((function(r){r.getGeometry().translate(e,t)}))},getConfig:function(e,t){return Array.isArray(this.config[e])?this.config[e][t||0]:this.config[e]},getFeaturesFromConfig:function(){var e={line:"LineString",path:"LineString",polygon:"Polygon",rectangle:"Polygon",point:"MultiPoint","multi-point":"MultiPoint"},t=[],r=this.config.data;if(["point","multi-point","MultiPoint"].includes(this.config.shape_type)){var n={type:"Feature"};n.geometry={type:"MultiPoint",coordinates:r},n.properties={label:this.getConfig("label"),size:this.getConfig("size"),edge_width:this.getConfig("edge_width"),edge_color:this.getConfig("edge_color"),face_color:this.getConfig("face_color")},t=[n]}else for(var a=0;a<r.length;a++){var i={},o=this.getConfig("shape_type",a);o=e[o]||o,i.type="Feature",i.geometry={type:o,coordinates:"Polygon"===o?[r[a]]:r[a]},i.properties={label:this.getConfig("label",a),size:this.getConfig("size"),edge_width:this.getConfig("edge_width",a),edge_color:this.getConfig("edge_color",a),face_color:this.getConfig("face_color",a)},t.push(i)}var s={type:"FeatureCollection",features:t},c=new W["a"];return c.readFeatures(s)},setupLayer:function(){var e=this;return Object(h["a"])(regeneratorRuntime.mark((function t(){var r,n,a;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(r=e.config.data,"string"!==typeof r){t.next=5;break}e.vector_source=new U["a"]({renderMode:"image",renderBuffer:10,url:r,format:new W["a"]}),t.next=12;break;case 5:if(!(r instanceof File)){t.next=11;break}return e.vector_source=new U["a"]({renderMode:"image",renderBuffer:10}),t.next=9,e.loadFeatures(r);case 9:t.next=12;break;case 11:r?(e.vector_source=new U["a"]({renderMode:"image",renderBuffer:10}),n=e.getFeaturesFromConfig(),e.vector_source.addFeatures(n)):e.vector_source=new U["a"]({renderMode:"image",renderBuffer:10});case 12:return a=new C["a"]({source:e.vector_source}),a.setStyle(e.featureStyle),e.vector_source.on("addfeature",(function(t){if(t.feature.get("id"))t.feature.setId(t.feature.get("id"));else{var r=$();t.feature.setId(r),t.feature.set("id",r)}if(e.config.add_feature_callback){var n=new W["a"];e.config.add_feature_callback(n.writeFeatureObject(t.feature))}var a=[],i=t.feature.get("label");if(i&&i===e.config.draw_label&&e.config.draw_max_label_count){var o=e.vector_source.getFeatures(),s=o.filter((function(e){return e.get("label")===i&&e!==t.feature}));if(s.length>=e.config.draw_max_label_count)for(var c=0;c<s.length-e.config.draw_max_label_count+1;c++){var _=s[c];a.push(_),e.vector_source.removeFeature(_)}}t.feature._undoing?delete t.feature._undoing:t.feature._skip_history||e.draw_history.push({add:t.feature,remove:a})})),e.vector_source.on("changefeature",(function(t){if(e.config.change_feature_callback){var r=new W["a"];e.config.change_feature_callback(r.writeFeatureObject(t.feature))}})),e.vector_source.on("removefeature",(function(t){if(e.config.remove_feature_callback){var r=new W["a"];e.config.remove_feature_callback(r.writeFeatureObject(t.feature))}t.feature._undoing?delete t.feature._undoing:t.feature._skip_history||e.draw_history.push({remove:t.feature})})),e.select=new T["a"]({wrapX:!1}),e.select.on("select",e.selectCallBack.bind(e)),e.map.addInteraction(e.select),e.disableSelectInteraction(),a.getLayerAPI=e.getLayerAPI,t.abrupt("return",a);case 23:case"end":return t.stop()}}),t)})))()},deleteDraw:function(){var e=this;if(this.vector_source)if(this.select){var t=this.select.getFeatures();0===t.length?this.clearFeatures():t.forEach((function(r){e.vector_source.removeFeature(r),t.remove(r)}))}else this.clearFeatures()},undoDraw:function(){var e=this;return Object(h["a"])(regeneratorRuntime.mark((function t(){var r,n,a,i,o;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(e.draw_history.length>0&&(r=e.draw_history.pop(),r.add&&(Array.isArray(r.add)||(r.add=[r.add]),n=e.vector_source.getFeatures(),n.forEach((function(t){var n,a=Object(y["a"])(r.add);try{for(a.s();!(n=a.n()).done;){var i=n.value;i===t&&(t._undoing=!0,e.vector_source.removeFeature(t),e.select&&e.select.getFeatures().remove(t))}}catch(o){a.e(o)}finally{a.f()}}))),r.remove)){Array.isArray(r.remove)||(r.remove=[r.remove]),a=Object(y["a"])(r.remove);try{for(a.s();!(i=a.n()).done;)o=i.value,o._undoing=!0,e.vector_source.addFeature(o)}catch(s){a.e(s)}finally{a.f()}}case 1:case"end":return t.stop()}}),t)})))()},getLayerAPI:function(){var e=this;return{_rintf:!0,name:this.config.name,id:this.config.id,clear_features:function(){e.vector_source.clear(!0)},update_config:function(t){for(var r in t)e.config[r]=t[r];e.$forceUpdate(),e.updateDrawInteraction()},update_feature:function(t,r){var n=e.vector_source.getFeatureById(t);if(!n)throw new Error("Feature not found (id=".concat(t,")"));var a=new W["a"],i=a.readFeature(r);n.setGeometry(i.getGeometry()),n.setProperties(i.getProperties())},set_features:function(t){var r=new W["a"],n=r.readFeatures(t);e.vector_source.clear(!0),e.vector_source.addFeatures(n)},select_feature:function(t){var r=e.select.getFeatures();r.clear();var n=e.vector_source.getFeatureById(t);n&&r.push(n),e.selectCallBack()},select_features:function(t){if(!Array.isArray(t))throw new Error("Please pass an id array");var r=e.select.getFeatures();r.clear();var n,a=Object(y["a"])(t);try{for(a.s();!(n=a.n()).done;){var i=n.value,o=e.vector_source.getFeatureById(i);o&&r.push(o)}}catch(s){a.e(s)}finally{a.f()}e.selectCallBack()},add_feature:function(t){var r=new W["a"],n=r.readFeature(t);e.vector_source.addFeature(n)},add_features:function(t){var r=new W["a"],n=r.readFeatures(t);e.vector_source.addFeatures(n)},get_features:function(t){t=t||{},void 0===t.decimals&&(t.decimals=2);var r=e.vector_source.getFeatures(),n=new W["a"],a=n.writeFeaturesObject(r,{decimals:t.decimals});return a}}},clearFeatures:function(){this.vector_source&&window.confirm("Are you sure about removing all the features in this layer (".concat(this.config.name,")?"))&&this.vector_source.clear(!0)},loadFeatures:function(e){var t=this;return new Promise((function(r,n){e||n("No file");var a=new FileReader;a.onload=function(e){try{var a=JSON.parse(e.target.result),i=new W["a"],o=i.readFeatures(a);t.vector_source.addFeatures(o),r()}catch(s){n(s)}},a.onerror=function(e){a.abort(),console.error(e)},a.readAsText(e)}))},exportFeatures:function(e){e=void 0===e?1:e;var t=this.vector_source.getFeatures(),r=new W["a"],n=r.writeFeaturesObject(t,{decimals:e}),a=new Blob([JSON.stringify(n)],{type:"text/plain;charset=utf-8"});q(a,this.config.name+"_"+this.config.id+".json")},enableSelectInteraction:function(){this.select.setActive(!0),this.selectIsActive=!0},disableSelectInteraction:function(){this.select.setActive(!1),this.selectIsActive=!1},updateDrawInteraction:function(){this.selected&&this.visible&&this.config.draw_enable?this.setupDrawInteraction():this.removeDrawInteraction()},removeDrawInteraction:function(){this.draw&&this.map.removeInteraction(this.draw)},featureStyle:function(e,t){var r=e.get("label"),n=e.get("size")||this.config.default_size,a=e.get("edge_color")||this.config.default_edge_color,i=e.get("edge_width")||this.config.default_edge_width,o=e.get("face_color")||this.config.default_face_color,s=new M["c"]({fill:new x["a"]({color:o}),stroke:new L["a"]({color:a,width:i}),text:new I["a"]({placement:this.config.text_placement||"line",offsetY:10,text:this.config.text_placement&&r,font:"14px Calibri,sans-serif",fill:new x["a"]({color:"#000"}),stroke:new L["a"]({color:a,width:3})}),image:new R["a"]({radius:n/Math.pow(t,1/3),stroke:new L["a"]({color:a,width:i}),fill:new x["a"]({color:o})})});return s},addComment:function(){this.currentMetadata.comments.push({id:$(),user_name:this.config.user_name,content:this.currentNewComment}),this.currentNewComment=""},removeComment:function(e){this.currentMetadata.comments=this.currentMetadata.comments.filter((function(t){return t.id!==e.id}))},normalizeTags:function(){var e=this;this.config.single_tag_mode&&this.currentMetadata.tags.length>1&&(this.currentMetadata.tags=[this.currentMetadata.tags[this.currentMetadata.tags.length-1]]),this.config.only_predefined_tags&&this.currentMetadata.tags.length>1&&this.config.predefined_tags&&this.config.predefined_tags.length>0&&(this.currentMetadata.tags=this.currentMetadata.tags.filter((function(t){return e.config.predefined_tags.includes(t)})))},updateMetadata:function(){this.currentMetadata&&(this.currentFeature.set("metadata",this.currentMetadata),this.config.change_feature_callback&&this.config.change_feature_callback(this.currentMetadata))},selectCallBack:function(){var e=this.select.getFeatures().getArray();if(1==e.length?(this.currentFeature=e[0],this.currentFeature&&(this.currentMetadata=this.currentFeature.get("metadata")||{tags:[],comments:[]}),this.currentNewComment=""):(this.currentFeature=null,this.currentMetadata=null),this.config.select_feature_callback){for(var t=new W["a"],r=[],n=0;n<e.length;n++)r.push(t.writeFeatureObject(e[n]));this.config.select_feature_callback(r.length>1?r:r[0])}},selectFeatures:function(e){var t=this,r=this.select.getFeatures();r.forEach((function(e){r.remove(e)})),e.forEach((function(e){r.push(e)})),this.$nextTick((function(){t.selectCallBack()}))},setupDrawInteraction:function(){var e=this;this.vector_source&&this.$nextTick((function(){e.draw&&e.map.removeInteraction(e.draw);var t,r,n=e.config.draw_shape_type;n=n.charAt(0).toUpperCase()+n.slice(1),"Square"===n?(r="Circle",t=Object(A["b"])(4)):"Rectangle"===n?(r="Circle",t=Object(A["a"])()):"Star"===n?(r="Circle",t=function(e,t){for(var r=e[0],n=e[1],a=r[0]-n[0],i=r[1]-n[1],o=Math.sqrt(a*a+i*i),s=Math.atan2(i,a),c=[],_=12,l=0;l<_;++l){var u=s+2*l*Math.PI/_,d=l%2===0?1:.5,f=o*d*Math.cos(u),p=o*d*Math.sin(u);c.push([r[0]+f,r[1]+p])}return c.push(c[0].slice()),t?t.setCoordinates([c]):t=new B["a"]([c]),t}):r="PolygonCutter"===n?"LineString":n;var a=new A["c"]({source:e.vector_source,type:r,freehand:e.config.draw_freehand,geometryFunction:t,style:new M["c"]({fill:new x["a"]({color:e.config.draw_face_color}),stroke:new L["a"]({color:e.config.draw_edge_color,width:e.config.draw_edge_width})})});e.draw=a,e.select.setActive(!1),e.map.addInteraction(a),a.on("drawend",function(){var t=Object(h["a"])(regeneratorRuntime.mark((function t(r){var a;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:a=r.feature,a.set("label",e.config.draw_label),a.set("size",e.config.draw_size),a.set("edge_color",e.config.draw_edge_color),a.set("edge_width",e.config.draw_edge_width),a.set("face_color",e.config.draw_face_color),"PolygonCutter"===n&&(a._skip_history=!0,setTimeout((function(){for(var t=a.getGeometry().getExtent(),r=e.vector_source.getFeatures(),n=new W["a"],i=[],o=[],s=0;s<r.length;s++){var c=r[s];if(c!==a){var _=c.getGeometry(),l=_.getType();if(Object(F["E"])(_.getExtent(),t)&&["Polygon","MultiPolygon"].includes(l)){var u=S["getGeom"](n.writeFeatureObject(a)),d=n.writeFeatureObject(c),f=S["getGeom"](d);try{u=S["simplify"](u,{tolerance:.1,highQuality:!1});var p=z(f,u,d.properties);if(p&&p.features.length>0){var m=n.readFeatures(p);e.vector_source.removeFeature(c),e.vector_source.addFeatures(m),i=i.concat(m),o.push(c)}}catch(g){console.error(g)}}}}(o.length>0||i.length>0)&&e.draw_history.push({remove:o,add:i}),e.vector_source.removeFeature(a)}),100));case 7:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}())}))}}},N=V,G=(r("8054"),Object(_["a"])(N,O,j,!1,null,null,null)),J=G.exports,H=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{staticClass:"image-layer"},[e.layer?r("section",[r("b-field",{attrs:{label:"opacity"}},[r("b-slider",{attrs:{min:0,max:1,step:.1},on:{input:e.updateOpacity},model:{value:e.config.opacity,callback:function(t){e.$set(e.config,"opacity",t)},expression:"config.opacity"}})],1)],1):e._e()])},Z=[],X=(r("5cc6"),r("9a8c"),r("a975"),r("735e"),r("c1ac"),r("d139"),r("3a7b"),r("d5d6"),r("82f8"),r("e91f"),r("60bd"),r("5f96"),r("3280"),r("3fcc"),r("ca91"),r("25a1"),r("cd26"),r("3c5d"),r("2954"),r("649e"),r("219c"),r("170b"),r("b39a"),r("72f7"),r("e7df")),Y=r("c810"),Q=r("f5dd");function ee(e){return new Promise((function(t,r){var n=new FileReader;n.onload=function(e){t(te(e.target.result))},n.onerror=function(e){r(e)},n.readAsDataURL(e)}))}function te(e){return re.apply(this,arguments)}function re(){return re=Object(h["a"])(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise((function(e,r){var n=new Image;n.crossOrigin="anonymous",n.onload=function(){var t=document.createElement("canvas"),r=t.getContext("2d");t.width=n.width,t.height=n.height,r.drawImage(n,0,0),e({url:t.toDataURL("image/png"),w:n.width,h:n.height})},n.onerror=function(e){r("image load error:"+String(e))},n.src=t})));case 1:case"end":return e.stop()}}),e)}))),re.apply(this,arguments)}function ne(e,t,r,n){var a=document.createElement("canvas");a.width=r,a.height=n;var i=a.getContext("2d"),o=i.getImageData(0,0,a.width,a.height),s=o.data,c=r*n,_=new Uint8Array(e.buffer);if(!(e instanceof Uint8Array))throw"unsupported array type";if(1===t)for(var l=0;l<c;l++)s[4*l]=_[l],s[4*l+1]=_[l],s[4*l+2]=_[l],s[4*l+3]=255;else if(2===t)for(var u=0;u<c;u++)s[4*u]=_[2*u],s[4*u+1]=_[2*u+1],s[4*u+2]=0,s[4*u+3]=255;else if(3===t)for(var d=0;d<c;d++)s[4*d]=_[3*d],s[4*d+1]=_[3*d+1],s[4*d+2]=_[3*d+2],s[4*d+3]=255;else if(4===t)for(var f=0;f<c;f++)s[4*f]=_[3*f],s[4*f+1]=_[3*f+1],s[4*f+2]=_[3*f+2],s[4*f+3]=_[4*f+3];return i.putImageData(o,0,0),{url:a.toDataURL("image/png"),w:r,h:n}}var ae={name:"image-layer",type:"2d-image",show:!1,props:{map:{type:w["a"],default:null},selected:{type:Boolean,default:!1},visible:{type:Boolean,default:!1},config:{type:Object,default:function(){return{}}}},data:function(){return{layer:null}},watch:{visible:function(e){this.layer.setVisible(e)}},mounted:function(){this.config.climit=[4,50],this.config.opacity=1,this.config.init=this.init},beforeDestroy:function(){this.layer&&this.map.removeLayer(this.layer)},created:function(){},methods:{init:function(){var e=this;return Object(h["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,e.setupLayer();case 2:return e.layer=t.sent,e.map.addLayer(e.layer),e.$forceUpdate(),t.abrupt("return",e.layer);case 6:case"end":return t.stop()}}),t)})))()},updateOpacity:function(){this.layer&&this.layer.setOpacity(this.config.opacity)},selectLayer:function(){},setupLayer:function(){var e=this;return Object(h["a"])(regeneratorRuntime.mark((function t(){var r,n,a,i,o,s;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(n=e.config.data,"string"!==typeof n){t.next=7;break}return t.next=4,te(e.config.data);case 4:r=t.sent,t.next=26;break;case 7:if(!(n instanceof File)){t.next=13;break}return t.next=10,ee(e.config.data);case 10:r=t.sent,t.next=26;break;case 13:if(!(n&&n.imageType&&n.size&&n.imageType.componentType&&n.data)){t.next=25;break}if("uint8_t"===n.imageType.componentType){t.next=16;break}throw"Unsupported data type: ".concat(n.imageType.componentType);case 16:if(!(n.imageType.components<1&&n.imageType.components>4)){t.next=18;break}throw"Unsupported components number: ".concat(n.imageType.components);case 18:if(2===n.imageType.dimension){t.next=20;break}throw"Dimension must be 2";case 20:if(1===n.imageType.pixelType){t.next=22;break}throw"Pixel type must be 1";case 22:r=ne(n.data,n.imageType.components,n.size[0],n.size[1]),t.next=26;break;case 25:r={url:"https://images.proteinatlas.org/19661/221_G2_1_red_green.jpg",w:2048,h:2048};case 26:return a=[0,0,r.w,r.h],i=new Q["a"]({code:"image",units:"pixels",extent:a}),o=new X["a"]({url:r.url,projection:i,imageExtent:a}),s=new Y["a"]({source:o}),e.$emit("update-extent",{id:e.config.id,extent:a}),t.abrupt("return",s);case 32:case"end":return t.stop()}}),t)})))()}}},ie=ae,oe=Object(_["a"])(ie,H,Z,!1,null,null,null),se=oe.exports,ce=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{staticClass:"itk-vtk-layer"},[r("section",[r("input",{ref:"file_input",staticStyle:{display:"none"},attrs:{type:"file",multiple:""},on:{change:function(t){e.resolveFiles&&e.resolveFiles(t)}}}),e.showLoadButton?r("b-button",{attrs:{"icon-left":"file-import"},on:{click:function(t){return e.$refs.file_input.click()}}},[e._v(" Load File(s) ")]):e._e()],1),e.layer?r("b-field",{attrs:{label:"opacity"}},[r("b-slider",{attrs:{min:0,max:1,step:.1},on:{input:e.updateOpacity},model:{value:e.config.opacity,callback:function(t){e.$set(e.config,"opacity",t)},expression:"config.opacity"}})],1):e._e(),e.layer?r("b-field",{attrs:{label:"Blending"}},[r("b-select",{attrs:{placeholder:"Select a mode"},model:{value:e.blending,callback:function(t){e.blending=t},expression:"blending"}},e._l(e.blendingOptions,(function(t){return r("option",{key:t,domProps:{value:t}},[e._v(" "+e._s(t)+" ")])})),0)],1):e._e(),r("section",{staticStyle:{position:"relative"},attrs:{id:"itk-vtk-control_"+e.config.id}})],1)},_e=[],le=(r("5319"),r("2ca0"),r("84c3"),r("53ca")),ue=r("4105"),de=r("1af9"),fe=r("5787"),pe=r.n(fe),me=window.itkVtkViewer,ge=function(e){function t(t){t=t||{},e.call(this,t),this.viewerElement=document.createElement("div"),this.viewerElement.classList.add("ol-layer"),this.viewerElement.style.position="absolute",this.viewerElement.style.width="100%",this.viewerElement.style.height="100%",this.sync_callback=t.sync_callback}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.getSourceState=function(){return"ready"},t.prototype.render=function(){return this.sync_callback&&this.sync_callback(),this.viewerElement.style.opacity=this.getOpacity(),this.viewerElement},t}(de["a"]);function he(e){return new Promise((function(t){var r=document.createElement("canvas"),n=new Image;n.onload=function(){r.width=n.width,r.height=n.height;var e=r.getContext("2d");e.translate(0,n.height),e.scale(1,-1),e.drawImage(n,0,0,n.width,n.height);var a=e.getImageData(0,0,n.width,n.height);t({imageType:{dimension:2,pixelType:1,componentType:"uint8_t",components:4},name:null,origin:[0,0],spacing:[1,1],direction:{data:[1,0,0,1]},size:[n.width,n.height],data:new Uint8Array(a.data.buffer)})},n.crossOrigin="Anonymous",n.src=e}))}var ye=function(e){return e.replace(/[A-Z]/g,(function(e){return"_".concat(e.toLowerCase())}))},be={name:"itk-vtk-layer",type:"itk-vtk",show:!0,props:{map:{type:w["a"],default:null},selected:{type:Boolean,default:!1},visible:{type:Boolean,default:!1},config:{type:Object,default:function(){return{}}}},data:function(){return{layer:null,mode:"2D",resolveFiles:null,showLoadButton:!1,blending:null,blendingOptions:["normal","multiply","screen","overlay","darken","lighten","color-dodge","color-burn","hard-light","soft-light","difference","exclusion","hue","saturation","color","luminosity"]}},watch:{visible:function(e){this.layer.setVisible(e),this.$forceUpdate()},blending:function(e){this.config.blending=e,this.layer&&(this.layer.viewerElement.style["mix-blend-mode"]=this.config.blending)}},mounted:function(){this.config.name=this.config.name||"itk-vtk image",this.config.opacity="number"===typeof this.config.opacity?this.config.opacity:1,this._lastOpacity=this.config.opacity,this.config.init=this.init,this.config.blending=this.config.blending||"normal",this.blending=this.config.blending},beforeDestroy:function(){this.layer&&this.map.removeLayer(this.layer)},created:function(){},methods:{init:function(){var e=this;return Object(h["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,e.setupLayer();case 2:return e.layer=t.sent,e.map.addLayer(e.layer),e.updateOpacity(),e.$forceUpdate(),t.abrupt("return",e.layer);case 7:case"end":return t.stop()}}),t)})))()},updateOpacity:function(){this.layer&&this.layer.setOpacity(this.config.opacity)},selectLayer:function(){},normalizeImage:function(e){return Object(h["a"])(regeneratorRuntime.mark((function t(){var r,n,a,i,o,s,c,_,l,u,d,f,p,m,g,h,y,b,v;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if("object"!==Object(le["a"])(e)){t.next=5;break}r=e,r._rtype&&"ndarray"===r._rtype&&(r=me.utils.ndarrayToItkImage(r)),t.next=25;break;case 5:if("string"!==typeof e){t.next=25;break}if(n=e.split("/").pop().split("#")[0].split("?")[0],!n.toLowerCase().endsWith(".png")){t.next=22;break}return t.next=10,fetch(e);case 10:return a=t.sent,t.next=13,a.arrayBuffer();case 13:if(i=t.sent,o=pe.a.decode(i),s=4,c="uint8_t",_=o.width*o.height,0==o.ctype)if(s=1,16===o.depth){for(r=new Uint16Array(_),l=0;l<o.height;l++)for(u=0;u<o.width;u++)d=l*o.width+u,r[(o.height-l)*o.width+u]=o.data[2*d]<<8|o.data[2*d+1];c="uint16_t"}else for(r=new Uint8Array(_),f=0;f<o.height;f++)for(p=0;p<o.width;p++)m=f*o.width+p,r[(o.height-f)*o.width+p]=o.data[m];else for(r=new Uint8Array(4*_),g=new Uint8Array(pe.a.toRGBA8(o)[0]),h=4*o.width,y=0;y<o.height;y++)for(b=0;b<h;b++)r[(o.height-y)*h+b]=g[y*h+b];r={imageType:{dimension:2,pixelType:1,componentType:c,components:s},name:null,origin:[0,0],spacing:[1,1],direction:{data:[1,0,0,1]},size:[o.width,o.height],data:r},t.next=25;break;case 22:return t.next=24,he(e);case 24:r=t.sent;case 25:return v=me.utils.vtkITKHelper.convertItkToVtkImage(r),t.abrupt("return",v);case 27:case"end":return t.stop()}}),t)})))()},setupLayer:function(){var e=this;return Object(h["a"])(regeneratorRuntime.mark((function t(){var r,n,a,i,o,s,c,_,l,u,d,f,p,m,g;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(r={position:"absolute",width:"100vw",height:"100vh",minHeight:"400px",minWidth:"400px",margin:"1",padding:"1",top:"0",left:"0",overflow:"hidden",display:"block-inline"},n={backgroundColor:[0,0,0,0],containerStyle:r},a=new ge,!e.config.data||e.config.data instanceof FileList||e.config.data instanceof File){t.next=14;break}return t.next=6,e.normalizeImage(e.config.data);case 6:c=t.sent,_=c.getExtent(),l=c.getDimensions(),s=2===l.length||3===l.length&&1===l[2],i=me.createViewer(a.viewerElement,{viewerStyle:n,image:c,pointSets:null,geometries:null,use2D:s,rotate:!1,uiContainer:document.getElementById("itk-vtk-control_"+e.config.id)}),o=[_[0],_[2],_[1],_[3]],t.next=39;break;case 14:if(!(e.config.data instanceof File)){t.next=18;break}u=[e.config.data],t.next=25;break;case 18:if(!(e.config.data instanceof FileList)){t.next=22;break}u=e.config.data,t.next=25;break;case 22:return t.next=24,e.getFiles();case 24:u=t.sent;case 25:return t.prev=25,e.$emit("loading",!0),t.next=29,me.utils.readFiles({files:u});case 29:d=t.sent,d.uiContainer=document.getElementById("toolbar"),s=d.use2D,d.uiContainer=document.getElementById("itk-vtk-control_"+e.config.id),i=me.createViewer(a.viewerElement,d),f=i.getViewProxy().getRenderer().getVolumes(),f.length>0?(p=f[0].getBounds(),o=[p[0],p[2],p[1],p[3]]):(console.warn("Extent is not set."),o=[0,0,100,100]);case 36:return t.prev=36,e.$emit("loading",!1),t.finish(36);case 39:if(i){t.next=41;break}throw"Failed to load itk-vtk-viewer";case 41:return e.config.name=e.config.name||e.config.type,m=i.getViewProxy(),g=m.getRenderWindow(),g.getViews()[0].initialize(),e.viewProxy=i.getViewProxy(),e.viewProxy.updateOrientation(2,1,[0,1,0]),e.renderWindow=e.viewProxy.getRenderWindow(),e.interactor=e.renderWindow.getInteractor(),s&&e.enableSync(a),e.renderer=e.viewProxy.getRenderer(),i.setUserInterfaceCollapsed(!0),setTimeout((function(){i.setUserInterfaceCollapsed(!1)}),10),e.viewer=i,e.$emit("update-extent",{id:e.config.id,extent:o}),a.getLayerAPI=e.getLayerAPI,a.setVisible=function(t){t?e._lastOpacity?e.config.opacity=e._lastOpacity:e.config.opacity=1:(e._lastOpacity=e.config.opacity,e.config.opacity=0),e.layer.setOpacity(e.config.opacity)},e.config.blending&&(a.viewerElement.style["mix-blend-mode"]=e.config.blending),t.abrupt("return",a);case 59:case"end":return t.stop()}}),t,null,[[25,,36,39]])})))()},getLayerAPI:function(){for(var e=this,t={_rintf:!0,name:this.config.name,id:this.config.id,set_blending:function(t){e.blending=t,e.$forceUpdate()},set_opacity:function(t){e.config.opacity=t,e.updateOpacity(),e.$forceUpdate()},set_image:function(t){return Object(h["a"])(regeneratorRuntime.mark((function r(){var n;return regeneratorRuntime.wrap((function(r){while(1)switch(r.prev=r.next){case 0:return r.next=2,e.normalizeImage(t);case 2:n=r.sent,e.viewer.setImage(n);case 4:case"end":return r.stop()}}),r)})))()}},r=0,n=Object.keys(e.viewer);r<n.length;r++){var a=n[r];"setImage"!==a&&(t[a]||!a.startsWith("set")&&!a.startsWith("get")||(t[ye(a.replace("UI","Ui"))]=e.viewer[a].bind(e.viewer)))}return t},getFiles:function(){var e=this;return new Promise((function(t){e.showLoadButton=!0,e.$refs.file_input.click(),e.resolveFiles=function(r){t(r.target.files),e.resolveFiles=null,e.showLoadButton=!1}}))},enableSync:function(e){var t=this.interactor.getView();t.getContainer().removeEventListener("wheel",this.interactor.handleWheel),t.getContainer().removeEventListener("mousedown",this.interactor.handleMouseDown),t.getContainer().removeEventListener("touchstart",this.interactor.handleTouchStart),e.sync_callback=this.synchronizeVtkCoordinate,this.enableItkInteraction(),this.renderWindow.render()},disableSync:function(e){if(e.sync_callback){e.sync_callback=null;var t=this.interactor.getView();t.getContainer().addEventListener("wheel",this.interactor.handleWheel),t.getContainer().addEventListener("mousedown",this.interactor.handleMouseDown)}this.disableItkInteraction()},convertCoordinates:function(e,t){var r=this.interactor.getView(),n={x:e,y:t},a=r.getContainer().getBoundingClientRect(),i=r.getCanvas(),o=i.width/a.width,s=i.height/a.height,c=this.map.getEventPixel({clientX:n.x/o+a.left,clientY:a.height-n.y/s+a.top}),_=this.map.getCoordinateFromPixelInternal(c),l=me.utils.vtkCoordinate.newInstance();l.setRenderer(this.renderer),l.setCoordinateSystemToDisplay(),l.setValue(n.x,n.y);var u=l.getComputedWorldValue();return{mapPosition:_,worldPosition:u}},synchronizeMapCoordinate:function(){var e=this.map.getView(),t=e.getResolution(),r=e.getCenter(),n=this.convertCoordinates(0,0),a=this.convertCoordinates(1,1),i=t/(n.mapPosition[0]-a.mapPosition[0]),o=Math.abs((n.worldPosition[0]-a.worldPosition[0])*i);0!==o&&o!==t&&e.setResolution(o);var s=n.worldPosition[0]-n.mapPosition[0],c=n.worldPosition[1]-n.mapPosition[1];e.setCenter([r[0]+s,r[1]+c])},synchronizeVtkCoordinate:function(){var e=this.viewProxy.getCamera(),t=e.getParallelScale(),r=this.convertCoordinates(0,0),n=this.convertCoordinates(100,100),a=t/(r.worldPosition[0]-n.worldPosition[0]),i=Math.abs((r.mapPosition[0]-n.mapPosition[0])*a);i&&i!==t&&(e.setParallelScale(i),this.viewProxy.updateDataProbeSize(),this.viewProxy.updateScaleBar());var o=this.convertCoordinates(0,0),s=o.worldPosition[0]-o.mapPosition[0],c=o.worldPosition[1]-o.mapPosition[1],_=e.getFocalPoint(),l=e.getPosition();e.setFocalPoint(_[0]-s,_[1]-c,_[2]),e.setPosition(l[0]-s,l[1]-c,l[2]),e.computeDistance(),this.viewProxy.renderLater()},enableItkInteraction:function(){var e=this;this.itkInteraction=new ue["b"],this.itkInteraction.handleEvent=function(t){e.itkInteraction.updateTrackedPointers_(t);var r=e.interactor;return"pointermove"==t.type&&r.handleMouseMove(t.originalEvent),!0},this.map.addInteraction(this.itkInteraction)},disableItkInteraction:function(){this.itkInteraction&&this.map.removeInteraction(this.itkInteraction)}}},ve=be,we=(r("6a21"),Object(_["a"])(ve,ce,_e,!1,null,null,null)),Ee=we.exports,ke=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{staticClass:"itk-vtk-layer"},[r("section",{staticStyle:{position:"relative"},attrs:{id:"itk-vtk-control_"+e.config.id}}),r("b-field",{attrs:{label:"opacity"}},[r("b-slider",{attrs:{min:0,max:1,step:.1},on:{input:e.updateOpacity},model:{value:e.config.opacity,callback:function(t){e.$set(e.config,"opacity",t)},expression:"config.opacity"}})],1)],1)},Oe=[],je=r("dff0"),Pe=r.n(je),De=function(e){function t(t){t=t||{},e.call(this,t),this.viewerElement=document.createElement("div"),this.viewerElement.classList.add("ol-layer"),this.viewerElement.style.position="absolute",this.viewerElement.style.width="100%",this.viewerElement.style.height="100%";var r=document.createElement("canvas");if(r.style.position="absolute",r.style.left="0",this.viewerElement.appendChild(r),this.canvasElement=r,!t.renderFunction)throw"render function is not specified";this._renderFunction=t.renderFunction}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.getSourceState=function(){return"ready"},t.prototype.render=function(e){var t=this;return this.viewerElement.style.opacity=this.getOpacity(),this._rendering?e.animate=!0:(this._rendering=!0,this._renderFunction(JSON.parse(Pe()({extent:e.extent,index:e.index,layerIndex:e.layerIndex,pixelRatio:e.pixelRatio,coordinateToPixelTransform:e.coordinateToPixelTransform,pixelToCorrdinateTransform:e.pixelToCorrdinateTransform,size:e.size,time:e.time,viewState:{center:e.viewState.center,resolution:e.viewState.resolution,rotation:e.viewState.rotation,zoom:e.viewState.zoom}}))).then((function(e){var r=t.canvasElement;requestAnimationFrame((function(){var t=new Image;t.onload=function(){r.width=t.width,r.height=t.height;var e=r.getContext("2d");e.drawImage(t,0,0)};var n=new Blob([e.data],{type:e.mime});t.src=URL.createObjectURL(n),e.transform&&(r.style.transform=e.transform)})),t._rendering=!1})).catch((function(e){console.error(e)}))),this.viewerElement},t}(de["a"]),Ce={name:"remote-layer",type:"remote",show:!1,props:{map:{type:w["a"],default:null},selected:{type:Boolean,default:!1},visible:{type:Boolean,default:!1},config:{type:Object,default:function(){return{}}}},data:function(){return{layer:null,mode:"2D"}},watch:{visible:function(e){this.layer.setVisible(e),this.renderWindow.render()}},mounted:function(){this.config.name=this.config.name||"remote",this.config.opacity=1,this.config.init=this.init},beforeDestroy:function(){this.layer&&this.map.removeLayer(this.layer)},created:function(){},methods:{init:function(){var e=this;return Object(h["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,e.setupLayer();case 2:return e.layer=t.sent,e.map.addLayer(e.layer),e.$forceUpdate(),t.abrupt("return",e.layer);case 6:case"end":return t.stop()}}),t)})))()},updateOpacity:function(){this.layer&&this.layer.setOpacity(this.config.opacity)},selectLayer:function(){},setupLayer:function(){var e=this;return Object(h["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.abrupt("return",new De({renderFunction:e.config.render}));case 1:case"end":return t.stop()}}),t)})))()}}},Me=Ce,xe=(r("02f9"),Object(_["a"])(Me,ke,Oe,!1,null,null,null)),Le=xe.exports,Ie=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{staticClass:"control-widget block floating-buttons"},e._l(e.config.elements,(function(t){return r("b-tooltip",{key:t.label,attrs:{label:t.tooltip||t.label,position:"is-bottom"}},["button"===t.type?r("button",{staticClass:"button is-small",staticStyle:{"min-width":"120px"},style:t.style,on:{click:function(r){return e.triggerCallback(t)}}},[t.icon?r("b-icon",{attrs:{icon:t.icon}}):e._e(),e._v(e._s(t.label)+" ")],1):"dropdown"===t.type?r("b-dropdown",{style:t.style,attrs:{"aria-role":"list"},on:{change:function(r){return e.triggerCallback(t,r)}},scopedSlots:e._u([{key:"trigger",fn:function(n){var a=n.active;return r("b-button",{staticClass:"is-primary",staticStyle:{height:"27px"},attrs:{"icon-left":t.icon}},[r("span",[e._v(e._s(void 0===t.value?t.label:t.value))]),r("b-icon",{attrs:{icon:a?"menu-up":"menu-down"}})],1)}}],null,!0),model:{value:t.value,callback:function(r){e.$set(t,"value",r)},expression:"elm.value"}},e._l(t.options,(function(t){return r("b-dropdown-item",{key:t,attrs:{value:t,"aria-role":"listitem"}},[e._v(e._s(t))])})),1):e._e()],1)})),1)},Re=[],Te={name:"control-widget",type:"control",props:{config:{type:Object,default:function(){return{}}}},data:function(){return{}},mounted:function(){if(this.config._resolve){var e=this;this.config._resolve({_rintf:!0,clear_elements:function(){e.config.elements=[],e.$forceUpdate()},set_elements:function(t){e.config.elements=t,e.$forceUpdate()}})}},methods:{triggerCallback:function(e,t){var r=this;return Object(h["a"])(regeneratorRuntime.mark((function n(){return regeneratorRuntime.wrap((function(n){while(1)switch(n.prev=n.next){case 0:if(n.prev=0,r.$emit("loading",!0),void 0===t){n.next=7;break}return n.next=5,e.callback(t);case 5:n.next=9;break;case 7:return n.next=9,e.callback();case 9:return n.prev=9,r.$emit("loading",!1),n.finish(9);case 12:case"end":return n.stop()}}),n,null,[[0,,9,12]])})))()}}},Ae=Te,Ue=(r("ff48"),Object(_["a"])(Ae,Ie,Re,!1,null,"6ae98d37",null)),We=Ue.exports,Be=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{staticClass:"form-widget"},[e.jsonFields&&e.jsonFields.length>0?r("form-json",{attrs:{btnReset:{value:e.config.reset_text||"Reset"},btnSubmit:{value:e.config.submit_text||"Submit"},camelizePayloadKeys:e.config.camelize_payload_keys,formFields:e.jsonFields,formName:e.config.name||"form",components:e.components}}):r("div",{staticClass:"box"},[r("article",{staticClass:"media"},[r("div",{staticClass:"media-content"},[r("div",{staticClass:"content"},[r("p",[e._v(" The form is empty ")])])])])])],1)},Fe=[],Se=(r("fb5f"),r("0df0")),Ke=r.n(Se),$e=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",[r("label",{staticClass:"label",attrs:{for:e.item.label}},[e._v(" "+e._s(e.item.label)+" "),!1!==e.item.isRequired?r("sup",{staticClass:"has-text-grey-light is-size-7"},[e._v("*")]):e._e()]),r("div",{staticClass:"control"},[r("b-taginput",{attrs:{id:e.item.label,data:e.item.options,"open-on-focus":e.item.options&&e.item.options.length>0,autocomplete:"","allow-new":e.item.allow_new||!e.item.options,icon:e.item.icon||"label",placeholder:e.item.placeholder},on:{input:function(t){return e.$emit("input",e.value)}},scopedSlots:e._u([{key:"empty",fn:function(){return[e._v(" There are no tags ")]},proxy:!0}]),model:{value:e.value,callback:function(t){e.value=t},expression:"value"}}),e.error?r("p",{staticClass:"help is-danger"},[e._v(" "+e._s(e.error)+" ")]):e._e()],1)])},qe=[],ze={name:"tags",props:{error:{type:String,default:null},item:{type:Object,required:!0}},data:function(){return{value:void 0}},created:function(){this.value=this.item.value,this.item.value&&this.$emit("input",this.item.value)}},Ve=ze,Ne=Object(_["a"])(Ve,$e,qe,!1,null,null,null),Ge=Ne.exports,Je=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",[r("label",{staticClass:"label",attrs:{for:e.item.label}},[e._v(" "+e._s(e.item.label)+" "),!1!==e.item.isRequired?r("sup",{staticClass:"has-text-grey-light is-size-7"},[e._v("*")]):e._e()]),r("div",{staticClass:"control"},[r("section",[r("b-field",[r("b-upload",{attrs:{id:e.item.label,multiple:"","drag-drop":""},on:{input:function(t){return e.updateFiles()}},model:{value:e.value,callback:function(t){e.value=t},expression:"value"}},[r("section",{staticClass:"section"},[r("div",{staticClass:"content has-text-centered"},[r("b-icon",{attrs:{icon:"upload",size:"is-large"}}),e._v(" Drop your files here or click to upload "),r("br"),e._l(e.value,(function(t,n){return r("span",{key:n,staticClass:"tag is-primary"},[e._v(" "+e._s(t.name.slice(0,20)+(t.name.length>20?"...":""))+" "),r("button",{staticClass:"delete is-small",attrs:{type:"button"},on:{click:function(t){return t.preventDefault(),e.removeFile(e.item.label,n)}}})])})),r("br"),e.value&&e.value.length>0?r("b-button",{staticClass:"is-small",on:{click:function(t){return t.preventDefault(),e.clearFiles()}}},[e._v("Clear files")]):e._e()],2)])])],1)],1),e.error?r("p",{staticClass:"help is-danger"},[e._v(" "+e._s(e.error)+" ")]):e._e()])])},He=[],Ze=(r("a434"),{name:"files",props:{error:{type:String,default:null},item:{type:Object,required:!0}},data:function(){return{value:void 0}},created:function(){this.value=this.item.value,this.item.value&&this.$emit("input",this.item.value)},methods:{removeFile:function(e,t){this.value.splice(t,1),this.$forceUpdate()},clearFiles:function(){this.value=null,this.$emit("input",null),this.$forceUpdate()},updateFiles:function(){this.$emit("input",this.value),this.$forceUpdate()},trimEllip:function(e,t){return e?("object"===Object(le["a"])(e)&&(e=e.toString()),e.length>t?e.substring(0,t)+"...":e):e}}}),Xe=Ze,Ye=Object(_["a"])(Xe,Je,He,!1,null,null,null),Qe=Ye.exports,et=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",[r("label",{staticClass:"label",attrs:{for:e.item.label}},[e._v(" "+e._s(e.item.label)+" "),!1!==e.item.isRequired?r("sup",{staticClass:"has-text-grey-light is-size-7"},[e._v("*")]):e._e()]),r("div",{staticClass:"control"},[r("b-button",{staticClass:"select-button",style:e.item.style,attrs:{id:e.item.label,"icon-left":e.item.icon},on:{click:function(t){return e.resolveCallback(e.item)}}},[e._v(" "+e._s(e.item.label)+" ")]),r("p",{staticClass:"help is-info"},[e._v(e._s(e.trimEllip(e.item.value,20)))]),e.error?r("p",{staticClass:"help is-danger"},[e._v(" "+e._s(e.error)+" ")]):e._e()],1)])},tt=[],rt={name:"button",props:{error:{type:String,default:null},item:{type:Object,required:!0}},data:function(){return{value:void 0}},created:function(){this.value=this.item.value,this.item.value&&this.$emit("input",this.item.value)},methods:{trimEllip:function(e,t){return e?("object"===Object(le["a"])(e)&&(e=e.toString()),e.length>t?e.substring(0,t)+"...":e):e},resolveCallback:function(e){var t=this;return Object(h["a"])(regeneratorRuntime.mark((function r(){return regeneratorRuntime.wrap((function(r){while(1)switch(r.prev=r.next){case 0:return r.next=2,Promise.resolve(e.callback());case 2:t.item.value=r.sent,t.$emit("input",t.item.value);case 4:case"end":return r.stop()}}),r)})))()}}},nt=rt,at=Object(_["a"])(nt,et,tt,!1,null,null,null),it=at.exports,ot={name:"form-widget",type:"form",components:{"form-json":Ke.a,TagInputField:Ge,SelectButtonField:it,DropFilesField:Qe},props:{config:{type:Object,default:function(){return{}}}},computed:{components:function(){return{TagInputField:Ge,SelectButtonField:it,DropFilesField:Qe}}},data:function(){return{jsonFields:[],dropFileFields:{}}},beforeDestroy:function(){this.$root.$off("formSubmitted",this.handleFormSubmitted)},mounted:function(){if(this.jsonFields=this.transformFields(this.config.fields),this.config.form_submit_callback=this.config.form_submit_callback||function(e){console.log("Form submitted",e)},this.$root.$on("formSubmitted",this.handleFormSubmitted),this.config._resolve){var e=this;this.config._resolve({_rintf:!0,clear_fields:function(){e.jsonFields=[],e.$forceUpdate()},set_fields:function(t){e.jsonFields=e.transformFields(t),e.$forceUpdate()}})}},methods:{transformFields:function(e){var t={};for(var r in this.components)t[this.components[r].name]=r;var n,a=Object(y["a"])(e);try{for(a.s();!(n=a.n()).done;){var i=n.value;if("tagInput"===i.slot){for(var o in i.props)i[o]=i.props[o];i.type="tags",delete i.slot,delete i.props}if("selectButton"===i.slot){for(var s in i.props)i[s]=i.props[s];i.type="button",delete i.slot,delete i.props}t[i.type]&&(i.is=t[i.type],delete i.type)}}catch(c){a.e(c)}finally{a.f()}return e},handleFormSubmitted:function(e){this.config.name&&e.formName===this.config.name&&this.config.form_submit_callback(e.values)}}},st=ot,ct=(r("5353"),Object(_["a"])(st,Be,Fe,!1,null,null,null)),_t=ct.exports,lt=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{staticClass:"list-widget"},[r("b-menu",[r("b-menu-list",e._l(e.config.elements,(function(t){return r("b-menu-item",{key:t.label,staticClass:"is-small",on:{click:function(r){return e.config.select_callback(t)}}},[r("template",{slot:"label"},[e._v(" "+e._s(t.label)+" ")])],2)})),1)],1)],1)},ut=[],dt={name:"list-widget",type:"list",props:{config:{type:Object,default:function(){return{}}}},data:function(){return{}},created:function(){this.config.select_callback=this.config.select_callback||function(){}},mounted:function(){this.config._resolve&&this.config._resolve({})},methods:{}},ft=dt,pt=(r("179d"),Object(_["a"])(ft,lt,ut,!1,null,"086af3ac",null)),mt=pt.exports,gt=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",[e.title?r("p",{staticClass:"vega-title"},[e._v(e._s(e.title))]):e._e(),r("vega",{ref:"main",attrs:{spec:e.config.spec,options:e.config.options},on:{ready:e.vegaReady}})],1)},ht=[],yt=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div")},bt=[],vt=r("e1a1"),wt=r("87e7"),Et={name:"vega",props:["spec","options"],mounted:function(){var e=this;Object(wt["a"])(this.$el,this.spec,this.options||{actions:!1}).then((function(t){e.embed=t,e.view=t.view,e.$emit("ready",{view:t.view,vega:vt})}))},data:function(){return{view:null,embed:null}},methods:{updateData:function(e,t){var r=vt["changeset"]().insert(t);this.view.change(e,r).run()},clearData:function(e){var t=vt["changeset"]().remove((function(){return!0}));this.view.change(e,t).run()}}},kt=Et,Ot=Object(_["a"])(kt,yt,bt,!1,null,null,null),jt=Ot.exports,Pt={name:"vega-widget",type:"vega",components:{vega:jt},props:{config:{type:Object,default:function(){return{}}}},data:function(){return{title:null}},created:function(){this.config.spec=this.config.spec||this.config.schema,this.config.options=this.config.options||{},this.config.options.width=this.config.options.width||200},mounted:function(){this.title=this.config.title},methods:{vegaReady:function(e){var t=this,r=e.view,n=e.vega;this.config.click_callback&&r.addEventListener("click",function(){var e=Object(h["a"])(regeneratorRuntime.mark((function e(r,n){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.prev=0,t.$emit("loading",!0),e.next=4,t.config.click_callback(n.datum);case 4:return e.prev=4,t.$emit("loading",!1),e.finish(4);case 7:case"end":return e.stop()}}),e,null,[[0,,4,7]])})));return function(t,r){return e.apply(this,arguments)}}()),this.config._resolve&&this.config._resolve({_rintf:!0,append:this.appendDataPoint,clear_data:this.clearData,set_title:this.setTitle,set_expression_function:function(e,t){n.expressionFunction(e,t)}})},setTitle:function(e){this.title=e,this.$forceUpdate()},appendDataPoint:function(e,t){this.$refs.main.updateData(e,t)},clearData:function(){this.$refs.main.clearData()}}},Dt=Pt,Ct=(r("dffd"),Object(_["a"])(Dt,gt,ht,!1,null,"e18eebbe",null)),Mt=Ct.exports,xt=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{staticClass:"list-widget"},[r("sl-vue-tree",{ref:"slVueTree",attrs:{"allow-multiselect":e.allowMultiselect},on:{select:e.nodeSelected,drop:e.nodeDropped,toggle:e.nodeToggled,nodedblclick:e.nodeDbClick},scopedSlots:e._u([{key:"title",fn:function(t){var n=t.node;return[r("span",{staticClass:"item-icon"},[n.isLeaf?r("b-icon",{staticClass:"small-icon",attrs:{icon:"file-outline"}}):r("b-icon",{staticClass:"small-icon",attrs:{icon:"folder-outline"}})],1),e._v(" "+e._s(n.title)+" ")]}},{key:"toggle",fn:function(t){var n=t.node;return[n.isLeaf?e._e():r("span",[n.isExpanded?r("b-icon",{staticClass:"small-icon",attrs:{icon:"chevron-down"}}):r("b-icon",{staticClass:"small-icon",attrs:{icon:"chevron-right"}})],1)]}}]),model:{value:e.config.nodes,callback:function(t){e.$set(e.config,"nodes",t)},expression:"config.nodes"}},[r("template",{slot:"draginfo"},[e._v(" "+e._s(e.selectedNodesTitle)+" ")])],2)],1)},Lt=[],It=(r("a15b"),r("8215"),r("c536")),Rt=r.n(It),Tt={name:"tree-widget",type:"tree",components:{SlVueTree:Rt.a},props:{config:{type:Object,default:function(){return{}}}},data:function(){return{lastEvent:"No last event",selectedNodesTitle:"",allowMultiselect:!1}},created:function(){this.config.allow_multi_select=this.allowMultiselect},mounted:function(){if(this.config._resolve){var e=this;this.config._resolve({_rintf:!0,get_nodes:function(){return e.config.nodes},clear_nodes:function(){e.config.nodes=[],e.$forceUpdate()},set_nodes:function(t){e.config.nodes=t,e.$forceUpdate()}})}},methods:{toggleVisibility:function(e,t){var r=this.$refs.slVueTree;e.stopPropagation();var n=!t.data||!1!==t.data.visible;r.updateNode(t.path,{data:{visible:!n}}),this.lastEvent="Node ".concat(t.title," is ").concat(n?"visible":"invisible"," now")},nodeSelected:function(e){var t=this;return Object(h["a"])(regeneratorRuntime.mark((function r(){return regeneratorRuntime.wrap((function(r){while(1)switch(r.prev=r.next){case 0:if(t.selectedNodesTitle=e.map((function(e){return e.title})).join(", "),t.lastEvent="Select nodes: ".concat(t.selectedNodesTitle),!t.config.node_select_callback){r.next=10;break}return r.prev=3,t.$emit("loading",!0),r.next=7,t.config.node_select_callback(e);case 7:return r.prev=7,t.$emit("loading",!1),r.finish(7);case 10:case"end":return r.stop()}}),r,null,[[3,,7,10]])})))()},nodeToggled:function(e){var t=this;return Object(h["a"])(regeneratorRuntime.mark((function r(){return regeneratorRuntime.wrap((function(r){while(1)switch(r.prev=r.next){case 0:if(t.lastEvent="Node ".concat(e.title," is ").concat(e.isExpanded?"expanded":"collapsed"),!t.config.node_toggle_callback){r.next=9;break}return r.prev=2,t.$emit("loading",!0),r.next=6,t.config.node_toggle_callback(e);case 6:return r.prev=6,t.$emit("loading",!1),r.finish(6);case 9:case"end":return r.stop()}}),r,null,[[2,,6,9]])})))()},nodeDbClick:function(e){var t=this;return Object(h["a"])(regeneratorRuntime.mark((function r(){return regeneratorRuntime.wrap((function(r){while(1)switch(r.prev=r.next){case 0:if(!t.config.node_dbclick_callback){r.next=8;break}return r.prev=1,t.$emit("loading",!0),r.next=5,t.config.node_dbclick_callback(e);case 5:return r.prev=5,t.$emit("loading",!1),r.finish(5);case 8:case"end":return r.stop()}}),r,null,[[1,,5,8]])})))()},nodeDropped:function(e,t){var r=this;return Object(h["a"])(regeneratorRuntime.mark((function n(){return regeneratorRuntime.wrap((function(n){while(1)switch(n.prev=n.next){case 0:if(r.lastEvent="Nodes: ".concat(e.map((function(e){return e.title})).join(", ")," are dropped ").concat(t.placement," ").concat(t.node.title),!r.config.node_drop_callback){n.next=9;break}return n.prev=2,r.$emit("loading",!0),n.next=6,r.config.node_drop_callback(e,t);case 6:return n.prev=6,r.$emit("loading",!1),n.finish(6);case 9:case"end":return n.stop()}}),n,null,[[2,,6,9]])})))()}}},At=Tt,Ut=(r("b4c7"),Object(_["a"])(At,xt,Lt,!1,null,null,null)),Wt=Ut.exports,Bt=r("256f"),Ft=r("2f62"),St=r("611f"),Kt=r("aa47"),$t={},qt={};for(var zt in n)$t[n[zt].name]=n[zt],qt[n[zt].type]=n[zt];var Vt={};for(var Nt in a)$t[a[Nt].name]=a[Nt],Vt[a[Nt].type]=a[Nt];var Gt=function(e,t,r){return Kt["a"].create(e,Object(i["a"])(Object(i["a"])({},t),{},{onEnd:function(e){var n=t.layer_configs.length-e.oldIndex-1,a=t.layer_configs.length-e.newIndex-1,i=t.layer_configs,o=i[n];if(a>n)for(var s=n;s<a;s++)i[s]=i[s+1];else for(var c=n;c>a;c--)i[c]=i[c-1];i[a]=o,r.componentInstance.$emit("sorted",i)}}))},Jt={name:"sortable",bind:function(e,t,r){var n=e.querySelector(".menu-list");n._sortable=Gt(n,t.value,r)},update:function(e,t,r){var n=e.querySelector(".menu-list");n._sortable.destroy(),n._sortable=Gt(n,t.value,r)},unbind:function(e){var t=e.querySelector(".menu-list");t._sortable.destroy()}};function Ht(e,t,r){var n;return function(){var a=this,i=arguments,o=function(){n=null,r||e.apply(a,i)},s=r&&!n;clearTimeout(n),n=setTimeout(o,t),s&&e.apply(a,i)}}function Zt(){return"ontouchstart"in window}var Xt={name:"ImageViewer",components:$t,directives:{sortable:Jt},data:function(){return{mode:"full",version:b["a"],sortableOptions:{delay:Zt()?100:null,chosenClass:"is-primary",draggable:".layer-item"},position:"static",open:!1,expandOnHover:!1,mobile:"fullwidth",reduce:!1,screenWidth:1e3,newLayerType:null,collections:null,layerTypes:qt,widgetTypes:Vt,loading:!1,activeSliders:[]}},mounted:function(){this.init(),this.sortableOptions.layer_configs=this.layer_configs,window.addEventListener("resize",this.updateSize),window.dispatchEvent(new Event("resize")),this.openSidebar(!0)},beforeDestroy:function(){window.removeEventListener("resize",this.updateSize)},computed:Object(i["a"])({sliderWidth:function(){return this.open&&"static"===this.position?"calc(100% - 310px)":"calc(100% - 20px )"},viewerWidth:function(){return this.open&&"static"===this.position?"calc(100% - 260px)":"calc(100%)"}},Object(Ft["b"])({layers:function(e){return e.layers},layer_configs:function(e){return e.layer_configs},standaloneWidgets:function(e){return e.standaloneWidgets},currentLayer:function(e){return e.currentLayer},currentLayerWidget:function(e){return e.currentLayerWidget},map:function(e){return e.map}})),methods:{loadFiles:function(e){var t,r=e.target.files,n={".json":"vector",".jpg":"2d-image",".png":"2d-image",".tif":"itk-vtk"},a=Object(y["a"])(r);try{for(a.s();!(t=a.n()).done;){for(var i=t.value,o=!1,s=0,c=Object.keys(n);s<c.length;s++){var _=c[s];if(i.name.endsWith(_)){this.addLayer({type:n[_],name:i.name,data:i}),o=!0;break}}o||this.addLayer({type:"itk-vtk",name:i.name,data:i})}}catch(l){a.e(l)}finally{a.f()}},setMode:function(e){this.mode=e,this.$forceUpdate()},goto:function(e){window.open(e,"_blank")},openSidebar:function(e){var t=this;setTimeout((function(){t.open=e,window.dispatchEvent(new Event("resize"))}),300)},updateSize:function(){var e=this;Ht((function(){e.screenWidth=window.innerWidth,e.screenWidth>800?("static"!=e.position&&(e.open=!0),e.position="static"):("absolute"!=e.position&&(e.open=!1),e.position="absolute"),e.$forceUpdate()}),250)()},layerSorted:function(){this.$store.commit("sortLayers")},removeLayer:function(e){this.$store.commit("removeLayer",e),this.$forceUpdate()},clearLayers:function(){this.$store.commit("clearLayers"),this.$forceUpdate()},toggleVisible:function(e){var t=this;this.$store.commit("toggleVisible",e),this.$nextTick((function(){t.map.updateSize(),t.map.renderSync()})),this.$forceUpdate()},selectLayer:function(e){this.$store.commit("setCurrentLayer",e)},newLayer:function(e){this.addLayer({type:e,name:e+"-"+k()})},addLayer:function(e){var t=this;return new Promise((function(r,n){e.id=k(),t.$store.dispatch("addLayer",e),e._add_layer_promise={resolve:r,reject:n}}))},updateExtent:function(e){var t=new Bt["b"]({code:"image",units:"pixels",extent:e.extent});this.map.setView(new v["a"]({projection:t,center:Object(F["x"])(e.extent),zoom:1,minZoom:-10}))},init:function(){var e=this;return Object(h["a"])(regeneratorRuntime.mark((function t(){var r,n,a;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(r=[0,0,1024,968],n=new Bt["b"]({code:"xkcd-image",units:"pixels",extent:r}),a=new w["a"]({interactions:Object(E["a"])({altShiftDragRotate:!1,pinchRotate:!1}),target:"map",layers:[],view:new v["a"]({projection:n,center:Object(F["x"])(r),zoom:2,maxZoom:8})}),e.$store.commit("setMap",a),window.self===window.top){t.next=8;break}Object(St["a"])({addLayer:e.addLayer,selectLayer:e.selectLayer,removeLayer:e.removeLayer,clearLayers:e.clearLayers,addWidget:e.addWidget,removeWidget:e.removeWidget,setLoader:e.setLoader,setMode:e.setMode,setSliders:e.setSliders,updateSlider:e.updateSlider,openSidebar:e.openSidebar}),t.next=11;break;case 8:return e.addLayer({type:"itk-vtk",name:"example image",data:"https://images.proteinatlas.org/19661/221_G2_1_red_green.jpg"}),t.next=11,e.addLayer({type:"vector",name:"shape vectors",data:"https://gist.githubusercontent.com/oeway/7c62128939a7f9b1701e2bbd72b809dc/raw/example_shape_vectors.json",predefined_tags:["nuclei","cell"],only_predefined_tags:!0,single_tag_mode:!1});case 11:case"end":return t.stop()}}),t)})))()},updateSlider:function(e,t){var r=this.activeSliders.filter((function(t){return t.name===e}));if(r.length<=0)throw new Error('Slider "'.concat(e,'" not found'));r[0].value=t},setSliders:function(e){this.activeSliders=e,this.$forceUpdate()},setLoader:function(e){this.loading=e,this.$forceUpdate()},addWidget:function(e){var t=this;return new Promise((function(r,n){e.name=e.name||"default",e.type?(e._resolve=r,e._reject=n,t.$store.dispatch("addWidget",e),t.$forceUpdate()):n("Please specify a widget type")}))},removeWidget:function(e){this.$store.dispatch("removeWidget",e),this.$forceUpdate()},screenshot:function(){var e=this;this.map.once("rendercomplete",(function(){var t=document.createElement("canvas"),r=e.map.getSize();t.width=r[0],t.height=r[1];var n=t.getContext("2d");if(Array.prototype.forEach.call(document.querySelectorAll(".ol-layer canvas"),(function(e){if(e.width>0){var t=e.parentNode.style.opacity;n.globalAlpha=""===t?1:Number(t);var r=e.style.transform;if(r){var a=r.match(/^matrix\(([^(]*)\)$/)[1].split(",").map(Number);CanvasRenderingContext2D.prototype.setTransform.apply(n,a)}n.drawImage(e,0,0)}})),navigator.msSaveBlob)navigator.msSaveBlob(t.msToBlob(),"kaibu-screenshot.png");else{var a=document.createElement("a");document.body.appendChild(a);var i=t.toDataURL();a.href=i,a.download="kaibu-screenshot.png",a.click(),setTimeout((function(){window.URL.revokeObjectURL(i),document.body.removeChild(a)}),0)}})),this.map.renderSync()}}},Yt=Xt,Qt=(r("2d07"),Object(_["a"])(Yt,m,g,!1,null,null,null)),er=Qt.exports;o["default"].use(p["a"]);var tr=[{path:"/",redirect:{name:"App"}},{path:"/app",name:"App",component:er},{path:"/about",name:"About",component:function(){return r.e("about").then(r.bind(null,"f820"))}}],rr=new p["a"]({base:"/",routes:tr}),nr=rr,ar=r("289d"),ir=(r("5363"),r("5abe"),r("7bb1")),or=r("4c93"),sr=r("2593");o["default"].use(Ft["a"]);var cr=new Ft["a"].Store({state:{layers:{},widgets:{},layer_configs:[],currentLayer:null,currentLayerWidget:null,standaloneWidgets:{},map:null},actions:{addWidget:function(e,t){e.commit("addWidget",t)},addLayer:function(e,t){e.commit("addLayer",t),o["default"].nextTick((function(){t.init&&t.init().then((function(r){r||t._add_layer_promise&&t._add_layer_promise.reject("Failed to create layer for "+t.name),r.config=t,r.setVisible(t.visible),r.getLayerAPI=r.getLayerAPI||function(){},e.commit("initialized",r),e.commit("setCurrentLayer",r.config),e.commit("sortLayers"),t._add_layer_promise&&(t._add_layer_promise.resolve(r),delete t._add_layer_promise)})).catch((function(e){t._add_layer_promise?(t._add_layer_promise.reject(e),delete t._add_layer_promise):console.error(e)}))}))}},mutations:{sortLayers:function(e){for(var t=0;t<e.layer_configs.length;t++)e.layers[e.layer_configs[t].id]?e.layers[e.layer_configs[t].id].setZIndex(t):console.warn("Layer not ready",e.layer_configs[t])},initialized:function(e,t){e.layers[t.config.id]=t,t.setZIndex(e.layer_configs.length-1)},addLayer:function(e,t){if(void 0===t.visible&&(t.visible=!0),"number"===typeof t.index){var r=t.index;e.layer_configs.splice(r,0,t),delete t.index}else e.layer_configs.push(t)},addWidget:function(e,t){e.widgets[t.name]=t,t.attach_to||(e.standaloneWidgets[t.name]=t)},removeWidget:function(e,t){delete e.widgets[t.name]},removeLayer:function(e,t){t.selected=!1,e.layer_configs=e.layer_configs.filter((function(e){return e.id!==t.id}))},clearLayers:function(e){e.layer_configs=[]},toggleVisible:function(e,t){t.visible=!t.visible},setCurrentLayer:function(e,t){if(t=e.layer_configs.filter((function(e){return e.id===t.id}))[0],e.currentLayer!==t){e.currentLayer&&(e.currentLayer.selected=!1),e.currentLayer=t,t.selected=!0,e.currentLayerWidget=null;for(var r=0,n=Object.keys(e.widgets);r<n.length;r++){var a=n[r];if(e.currentLayer.name&&e.widgets[a].attach_to==e.currentLayer.name){e.currentLayerWidget=e.widgets[a];break}}}},setMap:function(e,t){e.map=t}}});o["default"].use(ar["a"]),o["default"].config.productionTip=!1,o["default"].component("ValidationProvider",ir["a"]),Object.keys(or).forEach((function(e){Object(ir["b"])(e,Object(i["a"])(Object(i["a"])({},or[e]),{},{message:sr["a"][e]}))})),Object(ir["b"])("password",{params:["target"],validate:function(e,t){var r=t.target;return e===r},message:"Password does not match"}),new o["default"]({router:nr,render:function(e){return e(d)},store:cr}).$mount("#app")},"611f":function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.d(__webpack_exports__,"a",(function(){return setupImJoyAPI}));var core_js_modules_es_array_for_each_js__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("4160"),core_js_modules_es_array_for_each_js__WEBPACK_IMPORTED_MODULE_0___default=__webpack_require__.n(core_js_modules_es_array_for_each_js__WEBPACK_IMPORTED_MODULE_0__),core_js_modules_es_array_from_js__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("a630"),core_js_modules_es_array_from_js__WEBPACK_IMPORTED_MODULE_1___default=__webpack_require__.n(core_js_modules_es_array_from_js__WEBPACK_IMPORTED_MODULE_1__),core_js_modules_es_array_map_js__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("d81d"),core_js_modules_es_array_map_js__WEBPACK_IMPORTED_MODULE_2___default=__webpack_require__.n(core_js_modules_es_array_map_js__WEBPACK_IMPORTED_MODULE_2__),core_js_modules_es_array_buffer_constructor_js__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__("c19f"),core_js_modules_es_array_buffer_constructor_js__WEBPACK_IMPORTED_MODULE_3___default=__webpack_require__.n(core_js_modules_es_array_buffer_constructor_js__WEBPACK_IMPORTED_MODULE_3__),core_js_modules_es_function_name_js__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__("b0c0"),core_js_modules_es_function_name_js__WEBPACK_IMPORTED_MODULE_4___default=__webpack_require__.n(core_js_modules_es_function_name_js__WEBPACK_IMPORTED_MODULE_4__),core_js_modules_es_object_entries_js__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__("4fad"),core_js_modules_es_object_entries_js__WEBPACK_IMPORTED_MODULE_5___default=__webpack_require__.n(core_js_modules_es_object_entries_js__WEBPACK_IMPORTED_MODULE_5__),core_js_modules_es_object_get_prototype_of_js__WEBPACK_IMPORTED_MODULE_6__=__webpack_require__("3410"),core_js_modules_es_object_get_prototype_of_js__WEBPACK_IMPORTED_MODULE_6___default=__webpack_require__.n(core_js_modules_es_object_get_prototype_of_js__WEBPACK_IMPORTED_MODULE_6__),core_js_modules_es_object_to_string_js__WEBPACK_IMPORTED_MODULE_7__=__webpack_require__("d3b7"),core_js_modules_es_object_to_string_js__WEBPACK_IMPORTED_MODULE_7___default=__webpack_require__.n(core_js_modules_es_object_to_string_js__WEBPACK_IMPORTED_MODULE_7__),core_js_modules_es_string_iterator_js__WEBPACK_IMPORTED_MODULE_8__=__webpack_require__("3ca3"),core_js_modules_es_string_iterator_js__WEBPACK_IMPORTED_MODULE_8___default=__webpack_require__.n(core_js_modules_es_string_iterator_js__WEBPACK_IMPORTED_MODULE_8__),core_js_modules_es_typed_array_uint8_array_js__WEBPACK_IMPORTED_MODULE_9__=__webpack_require__("5cc6"),core_js_modules_es_typed_array_uint8_array_js__WEBPACK_IMPORTED_MODULE_9___default=__webpack_require__.n(core_js_modules_es_typed_array_uint8_array_js__WEBPACK_IMPORTED_MODULE_9__),core_js_modules_es_typed_array_copy_within_js__WEBPACK_IMPORTED_MODULE_10__=__webpack_require__("9a8c"),core_js_modules_es_typed_array_copy_within_js__WEBPACK_IMPORTED_MODULE_10___default=__webpack_require__.n(core_js_modules_es_typed_array_copy_within_js__WEBPACK_IMPORTED_MODULE_10__),core_js_modules_es_typed_array_every_js__WEBPACK_IMPORTED_MODULE_11__=__webpack_require__("a975"),core_js_modules_es_typed_array_every_js__WEBPACK_IMPORTED_MODULE_11___default=__webpack_require__.n(core_js_modules_es_typed_array_every_js__WEBPACK_IMPORTED_MODULE_11__),core_js_modules_es_typed_array_fill_js__WEBPACK_IMPORTED_MODULE_12__=__webpack_require__("735e"),core_js_modules_es_typed_array_fill_js__WEBPACK_IMPORTED_MODULE_12___default=__webpack_require__.n(core_js_modules_es_typed_array_fill_js__WEBPACK_IMPORTED_MODULE_12__),core_js_modules_es_typed_array_filter_js__WEBPACK_IMPORTED_MODULE_13__=__webpack_require__("c1ac"),core_js_modules_es_typed_array_filter_js__WEBPACK_IMPORTED_MODULE_13___default=__webpack_require__.n(core_js_modules_es_typed_array_filter_js__WEBPACK_IMPORTED_MODULE_13__),core_js_modules_es_typed_array_find_js__WEBPACK_IMPORTED_MODULE_14__=__webpack_require__("d139"),core_js_modules_es_typed_array_find_js__WEBPACK_IMPORTED_MODULE_14___default=__webpack_require__.n(core_js_modules_es_typed_array_find_js__WEBPACK_IMPORTED_MODULE_14__),core_js_modules_es_typed_array_find_index_js__WEBPACK_IMPORTED_MODULE_15__=__webpack_require__("3a7b"),core_js_modules_es_typed_array_find_index_js__WEBPACK_IMPORTED_MODULE_15___default=__webpack_require__.n(core_js_modules_es_typed_array_find_index_js__WEBPACK_IMPORTED_MODULE_15__),core_js_modules_es_typed_array_for_each_js__WEBPACK_IMPORTED_MODULE_16__=__webpack_require__("d5d6"),core_js_modules_es_typed_array_for_each_js__WEBPACK_IMPORTED_MODULE_16___default=__webpack_require__.n(core_js_modules_es_typed_array_for_each_js__WEBPACK_IMPORTED_MODULE_16__),core_js_modules_es_typed_array_includes_js__WEBPACK_IMPORTED_MODULE_17__=__webpack_require__("82f8"),core_js_modules_es_typed_array_includes_js__WEBPACK_IMPORTED_MODULE_17___default=__webpack_require__.n(core_js_modules_es_typed_array_includes_js__WEBPACK_IMPORTED_MODULE_17__),core_js_modules_es_typed_array_index_of_js__WEBPACK_IMPORTED_MODULE_18__=__webpack_require__("e91f"),core_js_modules_es_typed_array_index_of_js__WEBPACK_IMPORTED_MODULE_18___default=__webpack_require__.n(core_js_modules_es_typed_array_index_of_js__WEBPACK_IMPORTED_MODULE_18__),core_js_modules_es_typed_array_iterator_js__WEBPACK_IMPORTED_MODULE_19__=__webpack_require__("60bd"),core_js_modules_es_typed_array_iterator_js__WEBPACK_IMPORTED_MODULE_19___default=__webpack_require__.n(core_js_modules_es_typed_array_iterator_js__WEBPACK_IMPORTED_MODULE_19__),core_js_modules_es_typed_array_join_js__WEBPACK_IMPORTED_MODULE_20__=__webpack_require__("5f96"),core_js_modules_es_typed_array_join_js__WEBPACK_IMPORTED_MODULE_20___default=__webpack_require__.n(core_js_modules_es_typed_array_join_js__WEBPACK_IMPORTED_MODULE_20__),core_js_modules_es_typed_array_last_index_of_js__WEBPACK_IMPORTED_MODULE_21__=__webpack_require__("3280"),core_js_modules_es_typed_array_last_index_of_js__WEBPACK_IMPORTED_MODULE_21___default=__webpack_require__.n(core_js_modules_es_typed_array_last_index_of_js__WEBPACK_IMPORTED_MODULE_21__),core_js_modules_es_typed_array_map_js__WEBPACK_IMPORTED_MODULE_22__=__webpack_require__("3fcc"),core_js_modules_es_typed_array_map_js__WEBPACK_IMPORTED_MODULE_22___default=__webpack_require__.n(core_js_modules_es_typed_array_map_js__WEBPACK_IMPORTED_MODULE_22__),core_js_modules_es_typed_array_reduce_js__WEBPACK_IMPORTED_MODULE_23__=__webpack_require__("ca91"),core_js_modules_es_typed_array_reduce_js__WEBPACK_IMPORTED_MODULE_23___default=__webpack_require__.n(core_js_modules_es_typed_array_reduce_js__WEBPACK_IMPORTED_MODULE_23__),core_js_modules_es_typed_array_reduce_right_js__WEBPACK_IMPORTED_MODULE_24__=__webpack_require__("25a1"),core_js_modules_es_typed_array_reduce_right_js__WEBPACK_IMPORTED_MODULE_24___default=__webpack_require__.n(core_js_modules_es_typed_array_reduce_right_js__WEBPACK_IMPORTED_MODULE_24__),core_js_modules_es_typed_array_reverse_js__WEBPACK_IMPORTED_MODULE_25__=__webpack_require__("cd26"),core_js_modules_es_typed_array_reverse_js__WEBPACK_IMPORTED_MODULE_25___default=__webpack_require__.n(core_js_modules_es_typed_array_reverse_js__WEBPACK_IMPORTED_MODULE_25__),core_js_modules_es_typed_array_set_js__WEBPACK_IMPORTED_MODULE_26__=__webpack_require__("3c5d"),core_js_modules_es_typed_array_set_js__WEBPACK_IMPORTED_MODULE_26___default=__webpack_require__.n(core_js_modules_es_typed_array_set_js__WEBPACK_IMPORTED_MODULE_26__),core_js_modules_es_typed_array_slice_js__WEBPACK_IMPORTED_MODULE_27__=__webpack_require__("2954"),core_js_modules_es_typed_array_slice_js__WEBPACK_IMPORTED_MODULE_27___default=__webpack_require__.n(core_js_modules_es_typed_array_slice_js__WEBPACK_IMPORTED_MODULE_27__),core_js_modules_es_typed_array_some_js__WEBPACK_IMPORTED_MODULE_28__=__webpack_require__("649e"),core_js_modules_es_typed_array_some_js__WEBPACK_IMPORTED_MODULE_28___default=__webpack_require__.n(core_js_modules_es_typed_array_some_js__WEBPACK_IMPORTED_MODULE_28__),core_js_modules_es_typed_array_sort_js__WEBPACK_IMPORTED_MODULE_29__=__webpack_require__("219c"),core_js_modules_es_typed_array_sort_js__WEBPACK_IMPORTED_MODULE_29___default=__webpack_require__.n(core_js_modules_es_typed_array_sort_js__WEBPACK_IMPORTED_MODULE_29__),core_js_modules_es_typed_array_subarray_js__WEBPACK_IMPORTED_MODULE_30__=__webpack_require__("170b"),core_js_modules_es_typed_array_subarray_js__WEBPACK_IMPORTED_MODULE_30___default=__webpack_require__.n(core_js_modules_es_typed_array_subarray_js__WEBPACK_IMPORTED_MODULE_30__),core_js_modules_es_typed_array_to_locale_string_js__WEBPACK_IMPORTED_MODULE_31__=__webpack_require__("b39a"),core_js_modules_es_typed_array_to_locale_string_js__WEBPACK_IMPORTED_MODULE_31___default=__webpack_require__.n(core_js_modules_es_typed_array_to_locale_string_js__WEBPACK_IMPORTED_MODULE_31__),core_js_modules_es_typed_array_to_string_js__WEBPACK_IMPORTED_MODULE_32__=__webpack_require__("72f7"),core_js_modules_es_typed_array_to_string_js__WEBPACK_IMPORTED_MODULE_32___default=__webpack_require__.n(core_js_modules_es_typed_array_to_string_js__WEBPACK_IMPORTED_MODULE_32__),core_js_modules_web_dom_collections_for_each_js__WEBPACK_IMPORTED_MODULE_33__=__webpack_require__("159b"),core_js_modules_web_dom_collections_for_each_js__WEBPACK_IMPORTED_MODULE_33___default=__webpack_require__.n(core_js_modules_web_dom_collections_for_each_js__WEBPACK_IMPORTED_MODULE_33__),_home_runner_work_kaibu_kaibu_node_modules_babel_runtime_helpers_esm_createForOfIteratorHelper__WEBPACK_IMPORTED_MODULE_34__=__webpack_require__("b85c"),regenerator_runtime_runtime_js__WEBPACK_IMPORTED_MODULE_35__=__webpack_require__("96cf"),regenerator_runtime_runtime_js__WEBPACK_IMPORTED_MODULE_35___default=__webpack_require__.n(regenerator_runtime_runtime_js__WEBPACK_IMPORTED_MODULE_35__),_home_runner_work_kaibu_kaibu_node_modules_babel_runtime_helpers_esm_asyncToGenerator__WEBPACK_IMPORTED_MODULE_36__=__webpack_require__("1da1"),mathjs__WEBPACK_IMPORTED_MODULE_37__=__webpack_require__("3db5"),itkVtkViewer=window.itkVtkViewer,dtypeToTypedArray={int8:"Int8Array",int16:"Int16Array",int32:"Int32Array",uint8:"Uint8Array",uint16:"Uint16Array",uint32:"Uint32Array",float32:"Float32Array",float64:"Float64Array",array:"Array"},ArrayBufferView=Object.getPrototypeOf(Object.getPrototypeOf(new Uint8Array)).constructor;function toArray(data){if("number"===typeof data||"string"===typeof data||"boolean"===typeof data||null===data||void 0===data)return data;if(data instanceof ArrayBuffer)return Array.from(new Uint8Array(data));if(data instanceof ArrayBufferView)return Array.from(data);if(Array.isArray(data))return data.map(toArray);if(data.constructor===Object){if(data._rtype){if("ndarray"!==data._rtype)throw"Invalid input type: "+data._rtype;var arraytype=eval(dtypeToTypedArray[data._rdtype]);return Object(mathjs__WEBPACK_IMPORTED_MODULE_37__["a"])(Array.from(new arraytype(data._rvalue)),data._rshape)}var obj={};return Object.entries(data).forEach((function(e){obj[e[0]]=toArray(e[1])})),obj}throw new Error("Unsupported type conversion")}function setupImJoyAPI(e){return _setupImJoyAPI.apply(this,arguments)}function _setupImJoyAPI(){return _setupImJoyAPI=Object(_home_runner_work_kaibu_kaibu_node_modules_babel_runtime_helpers_esm_asyncToGenerator__WEBPACK_IMPORTED_MODULE_36__["a"])(regeneratorRuntime.mark((function e(t){var r,n,a,i,o,s,c,_,l,u,d,f,p,m;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return r=t.addLayer,n=t.selectLayer,a=t.removeLayer,i=t.clearLayers,o=t.addWidget,s=t.removeWidget,c=t.setLoader,_=t.setMode,l=t.setSliders,u=t.updateSlider,d=t.openSidebar,_("lite"),e.next=4,window.imjoyLoader.loadImJoyRPC({api_version:"0.2.3"});case 4:return f=e.sent,e.next=7,f.setupRPC({name:"Kaibu",version:"0.1.0",description:"Kaibu--a web application for visualizing and annotating multi-dimensional images",type:"rpc-window"});case 7:p=e.sent,p.registerCodec({name:"itkimage",decoder:itkVtkViewer.utils.convertToItkImage}),m={setup:function(){p.log("Kaibu loaded successfully.")},run:function(e){return Object(_home_runner_work_kaibu_kaibu_node_modules_babel_runtime_helpers_esm_asyncToGenerator__WEBPACK_IMPORTED_MODULE_36__["a"])(regeneratorRuntime.mark((function t(){var n,a,i,o,s;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(e.config&&e.config.mode&&_(e.config.mode),e.config&&void 0!==e.config.open_sidebar&&d(e.config.open_sidebar),!e.data||!e.data.layers){t.next=24;break}n=[],a=Object(_home_runner_work_kaibu_kaibu_node_modules_babel_runtime_helpers_esm_createForOfIteratorHelper__WEBPACK_IMPORTED_MODULE_34__["a"])(e.data.layers),t.prev=5,a.s();case 7:if((i=a.n()).done){t.next=15;break}return o=i.value,t.next=11,r(o);case 11:s=t.sent,n.push(s.getLayerAPI());case 13:t.next=7;break;case 15:t.next=20;break;case 17:t.prev=17,t.t0=t["catch"](5),a.e(t.t0);case 20:return t.prev=20,a.f(),t.finish(20);case 23:return t.abrupt("return",n);case 24:case"end":return t.stop()}}),t,null,[[5,17,20,23]])})))()},add_layer:r,select_layer:n,remove_layer:a,clear_layers:i,open_sidebar:d,view_image:function(e,t){return Object(_home_runner_work_kaibu_kaibu_node_modules_babel_runtime_helpers_esm_asyncToGenerator__WEBPACK_IMPORTED_MODULE_36__["a"])(regeneratorRuntime.mark((function n(){var a;return regeneratorRuntime.wrap((function(n){while(1)switch(n.prev=n.next){case 0:return t=t||{},t.type=t.type||"itk-vtk",t.name=t.name||t.type,t.data=e,n.next=6,r(t);case 6:return a=n.sent,n.abrupt("return",a.getLayerAPI());case 8:case"end":return n.stop()}}),n)})))()},add_shapes:function(e,t){return Object(_home_runner_work_kaibu_kaibu_node_modules_babel_runtime_helpers_esm_asyncToGenerator__WEBPACK_IMPORTED_MODULE_36__["a"])(regeneratorRuntime.mark((function n(){var a;return regeneratorRuntime.wrap((function(n){while(1)switch(n.prev=n.next){case 0:return t=t||{},t.type="vector",t.data=toArray(e),n.next=5,r(t);case 5:return a=n.sent,n.abrupt("return",a.getLayerAPI());case 7:case"end":return n.stop()}}),n)})))()},add_points:function(e,t){return Object(_home_runner_work_kaibu_kaibu_node_modules_babel_runtime_helpers_esm_asyncToGenerator__WEBPACK_IMPORTED_MODULE_36__["a"])(regeneratorRuntime.mark((function n(){var a;return regeneratorRuntime.wrap((function(n){while(1)switch(n.prev=n.next){case 0:return t=t||{},t.type="vector",t.data=toArray(e),t.shape_type="MultiPoint",n.next=6,r(t);case 6:return a=n.sent,n.abrupt("return",a.getLayerAPI());case 8:case"end":return n.stop()}}),n)})))()},set_ui:function(e){return Object(_home_runner_work_kaibu_kaibu_node_modules_babel_runtime_helpers_esm_asyncToGenerator__WEBPACK_IMPORTED_MODULE_36__["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return e.type=e.type||"control",e.name=e.title,t.next=4,o(e);case 4:return t.abrupt("return",t.sent);case 5:case"end":return t.stop()}}),t)})))()},add_widget:function(e){return Object(_home_runner_work_kaibu_kaibu_node_modules_babel_runtime_helpers_esm_asyncToGenerator__WEBPACK_IMPORTED_MODULE_36__["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,o(e);case 2:return t.abrupt("return",t.sent);case 3:case"end":return t.stop()}}),t)})))()},remove_widget:function(e){return Object(_home_runner_work_kaibu_kaibu_node_modules_babel_runtime_helpers_esm_asyncToGenerator__WEBPACK_IMPORTED_MODULE_36__["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,s(e);case 2:return t.abrupt("return",t.sent);case 3:case"end":return t.stop()}}),t)})))()},set_loader:function(e){return Object(_home_runner_work_kaibu_kaibu_node_modules_babel_runtime_helpers_esm_asyncToGenerator__WEBPACK_IMPORTED_MODULE_36__["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:c(e);case 1:case"end":return t.stop()}}),t)})))()},set_timeout:function(e,t){return Object(_home_runner_work_kaibu_kaibu_node_modules_babel_runtime_helpers_esm_asyncToGenerator__WEBPACK_IMPORTED_MODULE_36__["a"])(regeneratorRuntime.mark((function r(){return regeneratorRuntime.wrap((function(r){while(1)switch(r.prev=r.next){case 0:return r.abrupt("return",setTimeout(e,t));case 1:case"end":return r.stop()}}),r)})))()},clear_timeout:function(e){return Object(_home_runner_work_kaibu_kaibu_node_modules_babel_runtime_helpers_esm_asyncToGenerator__WEBPACK_IMPORTED_MODULE_36__["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:clearTimeout(e);case 1:case"end":return t.stop()}}),t)})))()},set_mode:function(e){return Object(_home_runner_work_kaibu_kaibu_node_modules_babel_runtime_helpers_esm_asyncToGenerator__WEBPACK_IMPORTED_MODULE_36__["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:_(e);case 1:case"end":return t.stop()}}),t)})))()},set_sliders:function(e){return Object(_home_runner_work_kaibu_kaibu_node_modules_babel_runtime_helpers_esm_asyncToGenerator__WEBPACK_IMPORTED_MODULE_36__["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:l(e);case 1:case"end":return t.stop()}}),t)})))()},update_slider:function(e,t){return Object(_home_runner_work_kaibu_kaibu_node_modules_babel_runtime_helpers_esm_asyncToGenerator__WEBPACK_IMPORTED_MODULE_36__["a"])(regeneratorRuntime.mark((function r(){return regeneratorRuntime.wrap((function(r){while(1)switch(r.prev=r.next){case 0:u(e,t);case 1:case"end":return r.stop()}}),r)})))()}},m.add_image=m.view_image,p.export(m);case 12:case"end":return e.stop()}}),e)}))),_setupImJoyAPI.apply(this,arguments)}},"6a21":function(e,t,r){"use strict";r("e38f")},"794c":function(e,t,r){},8054:function(e,t,r){"use strict";r("b3e1")},8215:function(e,t,r){},"889b":function(e,t,r){},9224:function(e){e.exports=JSON.parse('{"a":"0.1.42"}')},b3e1:function(e,t,r){},b4c7:function(e,t,r){"use strict";r("889b")},dffd:function(e,t,r){"use strict";r("23a7")},e38f:function(e,t,r){},f02d:function(e,t,r){},ff48:function(e,t,r){"use strict";r("794c")}});
//# sourceMappingURL=app.b4b822f5.js.map